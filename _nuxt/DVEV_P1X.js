import{_ as E}from"./CF46f3p9.js";import{_ as G}from"./C6A0-C8C.js";import{B as L,r as p,e as V,c as d,b as D,f as H,a as t,i as x,d as w,m as O,E as U,F as R,g as P,o as i,t as u,n as F,w as K,T as q,ah as Y,p as Q}from"#entry";import"./BLMuvzoS.js";import{_ as W}from"./DlAUqK2U.js";const X={class:"bg-gray-50"},Z={class:"border-t-2 border-green-700 shadow-lg lg:my-5 my-3 lg:pb-10 w-11/12 mx-auto"},ee={class:"lg:p-5 p-2"},te={class:"flex"},ae={class:"flex lg:w-4/12 w-11/12 mx-auto my-3 text-center lg:rounded-lg rounded-md"},se={class:"flex w-full"},le={class:"w-full"},re={key:0,class:"lg:text-sm text-xs text-red-800 text-center mt-5 py-2 px-4 rounded-sm shadow lg:w-6/12 mx-auto bg-red-100"},oe={key:0,class:"px-4 py-2 lg:w-11/12 mx-auto"},de={class:"border-2 border-gray-200 shadow-md rounded-md overflow-hidden"},ie={class:"bg-gray-100 text-green-900 font-bold text-center uppercase text-sm lg:text-base py-2 px-5 border-b"},ne={class:"p-4 space-y-4"},ce={class:"list-disc pl-5 text-sm text-gray-800"},ue={key:0,class:"text-gray-600 text-xs flex items-center gap-2"},pe={class:"lg:flex gap-3 w-full"},ge={key:0,class:"w-full"},fe={class:"border-2 border-dashed border-green-400 p-3 rounded-md bg-green-50"},me=["onChange"],xe={key:1,class:"w-full"},ve={class:"border-2 border-dashed border-green-400 p-3 rounded-md bg-green-50"},_e=["onChange"],ye={key:2,class:"space-y-3"},be={key:0,class:"mt-4"},he={class:"relative border border-gray-300 rounded-xl bg-gray-50 shadow-inner max-h-[300px] overflow-y-auto flex flex-col p-3 space-y-2",id:"chatBox"},we={class:"flex justify-start"},ke={class:"bg-white border border-gray-200 text-gray-800 px-3 py-2 rounded-xl max-w-[80%] text-sm shadow-sm"},Te={key:0,class:"flex justify-end"},Ce={class:"bg-green-600 text-white px-3 py-2 rounded-xl max-w-[80%] text-sm shadow-sm"},Se={key:0,class:"absolute bottom-16 left-1/2 -translate-x-1/2 bg-green-700 text-white text-xs font-medium px-4 py-2 rounded-lg shadow-md"},$e={class:"mt-3 flex items-center gap-2"},De=["onKeyup"],Re=["onClick","disabled"],Pe={key:0},Ne={key:1},Ae={key:3},Ie={class:"text-sm text-gray-800"},Oe={class:"text-sm text-gray-800 space-y-1"},Ue={class:"bg-gray-100 p-4 rounded-md mt-3 space-y-2"},Fe={class:"text-sm text-gray-800"},Je={class:"text-sm text-gray-800"},Me={class:"text-sm text-gray-800"},je={class:"text-sm text-gray-800"},ze={__name:"index",setup(Be){const J=L(),g=p(J.mainDevServer),h=p([]),k=p(""),v=p([]),T=p(!1),_=p({}),f=p({});V(async()=>{try{const o=await $fetch(g.value+"/api/registrar/list");h.value=o||[]}catch(o){console.error("Fetch error:",o)}});const M=()=>{const o=k.value.trim().toUpperCase();o?(v.value=h.value.filter(e=>e?.tracking_id===o),T.value=v.value.length===0):(v.value=[],T.value=!1)},N=o=>{const e=(o?.logs?.[0]?.status_remarks||"").toLowerCase();return e==="assessment"||e==="preparing documents"};async function j(o,e){const m=o.target.files?.[0];if(!m||!e)return;const l=e.tracking_id;_.value[l]=!0,f.value[l]={ok:!1,msg:""};try{const a=new FormData;a.append("file",m);const c=await $fetch(g.value+"/api/registrar/upload/",{method:"POST",body:a}),n=Array.isArray(c)?c.map(r=>({name:r.name||r.file?.split("/").pop(),url:r.url||r.file})):[{name:c.name||c.file?.split("/").pop(),url:c.url||c.file}],s=await $fetch(`${g.value}/api/registrar/payment/by-tracking/?tracking_id=${encodeURIComponent(l)}`).catch(()=>null);if(s){const r=[...s.receipt_image_url||[],...n],$={payment_id:s.payment_id||"",fullname:s.fullname||"",email:s.email||"",course:s.course||"",college:s.college||"",date_graduated_last_attended:s.date_graduated_last_attended||"",total:s.total||"",detail_fees:JSON.stringify(s.detail_fees||[]),tracking_id:s.tracking_id||l,receipt_image_url:JSON.stringify(r)};await $fetch(`${g.value}/api/registrar/payment/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:$})}else{const r={payment_id:"",fullname:"",email:"",course:"",college:"",date_graduated_last_attended:"",total:"",detail_fees:JSON.stringify([]),tracking_id:l,receipt_image_url:JSON.stringify(n)};await $fetch(g.value+"/api/registrar/payment/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:r})}try{await $fetch(g.value+"/api/registrar/status/confirm-receipt/",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:e.id,latest_status:"Confirm Receipt"}})}catch(r){console.warn("Receipt uploaded, but email notification failed:",r)}f.value[l]={ok:!0,msg:"Receipt uploaded successfully."}}catch(a){console.error("Upload receipt failed",a),f.value[l]={ok:!1,msg:"Failed to upload receipt. Please try again."}}finally{_.value[l]=!1,o.target.value=""}}async function z(o,e){const m=o.target.files?.[0];if(!m||!e)return;const l=e.tracking_id;_.value[l]=!0,f.value[l]={ok:!1,msg:""};try{const a=new FormData;a.append("file",m);const c=await $fetch(g.value+"/api/registrar/upload/",{method:"POST",body:a}),n=Array.isArray(c)?c.map(r=>({name:r.name||r.file?.split("/").pop(),url:r.url||r.file})):[{name:c.name||c.file?.split("/").pop(),url:c.url||c.file}],s=await $fetch(`${g.value}/api/registrar/payment/by-tracking/?tracking_id=${encodeURIComponent(l)}`).catch(()=>null);if(s){const r=[...s.additional_docs_image_url||[],...n],$={payment_id:s.payment_id||"",fullname:s.fullname||"",email:s.email||"",course:s.course||"",college:s.college||"",date_graduated_last_attended:s.date_graduated_last_attended||"",total:s.total||"",detail_fees:JSON.stringify(s.detail_fees||[]),tracking_id:s.tracking_id||l,receipt_image_url:JSON.stringify(s.receipt_image_url||[]),additional_docs_image_url:JSON.stringify(r)};await $fetch(`${g.value}/api/registrar/payment/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:$})}else{const r={payment_id:"",fullname:"",email:"",course:"",college:"",date_graduated_last_attended:"",total:"",detail_fees:JSON.stringify([]),tracking_id:l,receipt_image_url:JSON.stringify([]),additional_docs_image_url:JSON.stringify(n)};await $fetch(g.value+"/api/registrar/payment/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:r})}try{await $fetch(g.value+"/api/registrar/status/confirm-receipt/",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:e.id,latest_status:"Confirm Receipt"}})}catch(r){console.warn("File uploaded, but email notification failed:",r)}f.value[l]={ok:!0,msg:"Additional document uploaded successfully."}}catch(a){console.error("Upload additional docs failed",a),f.value[l]={ok:!1,msg:"Failed to upload additional document. Please try again."}}finally{_.value[l]=!1,o.target.value=""}}const B=p(""),C=p(""),y=p(!1),A=p(""),S=p(!1),b=p(""),I=async o=>{C.value="",B.value="",y.value=!0;try{const e={...o,additional_response_details:b.value||""};await $fetch(`${g.value}/api/registrar/${o.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:e}),o.additional_response_details=e.additional_response_details;const m=h.value.findIndex(l=>l.id===o.id);return m!==-1&&(h.value[m].additional_response_details=e.additional_response_details),A.value="✅ Response submitted successfully!",S.value=!0,setTimeout(()=>S.value=!1,3e3),y.value=!1,b.value="",!0}catch(e){return console.error("Error updating response:",e),C.value="❌ Failed to update record.",setTimeout(()=>C.value="",3e3),y.value=!1,!1}};return(o,e)=>{const m=E,l=G;return i(),d("div",X,[D(m),e[18]||(e[18]=H('<div class="relative" data-v-f0646dc9><div class="bg-green-700 lg:h-[200px] h-[130px]" data-v-f0646dc9><div class="lg:pt-10 absolute top-1/2 transform -translate-y-1/2 w-full" data-v-f0646dc9><p class="font-bold uppercase text-white lg:text-2xl text-sm w-11/12 mx-auto" data-v-f0646dc9> REGISTRAR </p><p class="text-xs w-11/12 mx-auto text-white" data-v-f0646dc9> Higher Education Registrar Appointment </p></div></div><div class="shadow-lg text-green-700" data-v-f0646dc9><div class="lg:flex justify-between border-b border-gray-200 lg:pl-5" data-v-f0646dc9><div class="flex items-center capitalize text-xs lg:border-b-0 border-b lg:px-0 px-1.5 py-2" data-v-f0646dc9><div data-v-f0646dc9><a href="/registrar" class="mr-2 hover:underline lg:h-10" data-v-f0646dc9>Home</a></div><div data-v-f0646dc9><i class="fas fa-caret-right" data-v-f0646dc9></i><a href="/registrar/heu/appointment" class="mx-2 hover:underline lg:h-10" data-v-f0646dc9>HEU Appointment</a></div></div><div class="flex hover:text-green-800 text-white bg-white h-full" data-v-f0646dc9><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-f0646dc9><a href="/registrar" class="flex items-center w-fit mx-auto" data-v-f0646dc9><i class="fa fa-video-camera" aria-hidden="true" data-v-f0646dc9></i><span class="ml-3 whitespace-nowrap" data-v-f0646dc9>Demo Guide</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-f0646dc9><a href="/registrar/track" class="flex items-center w-fit mx-auto" data-v-f0646dc9><i class="fa fa-universal-access" aria-hidden="true" data-v-f0646dc9></i><span class="ml-3 whitespace-nowrap" data-v-f0646dc9>Track</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full" data-v-f0646dc9><a href="/registrar/login" class="flex items-center w-fit mx-auto" data-v-f0646dc9><i class="fa fa-user" aria-hidden="true" data-v-f0646dc9></i><span class="ml-3 whitespace-nowrap" data-v-f0646dc9>Admin Login</span></a></div></div></div></div></div>',1)),t("div",Z,[e[17]||(e[17]=t("h2",{class:"lg:text-base text-xs px-10 uppercase py-2 font-bold bg-green-900 text-white text-center"},[t("i",{class:"fa fa-certificate text-white mr-2"}),w(" Appointment Tracker ")],-1)),t("div",ee,[t("div",te,[t("div",ae,[t("div",se,[t("div",le,[O(t("input",{class:"py-1.5 pl-2 pr-2 uppercase w-full border-2 border-green-700 rounded-tl-md rounded-bl-md text-xs",placeholder:"Enter 20-digit Tracking ID","onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),maxlength:"20"},null,512),[[U,k.value]])]),t("div",null,[t("button",{class:"bg-green-700 hover:bg-green-800 text-white text-xs px-4 py-[7.7px] rounded-tr-md rounded-br-md",onClick:M}," Track ")])])])]),T.value?(i(),d("div",re," Can't find Tracking ID! ")):x("",!0)]),v.value.length>0?(i(),d("div",oe,[(i(!0),d(R,null,P(v.value,(a,c)=>(i(),d("div",{key:c,class:"mb-6"},[t("div",de,[t("h2",ie," Tracking ID: "+u(a.tracking_id),1),t("div",ne,[t("div",null,[e[2]||(e[2]=t("label",{class:"block font-semibold text-xs text-gray-700 mb-1"},"Status:",-1)),t("ul",ce,[(i(!0),d(R,null,P(a.logs,(n,s)=>(i(),d("li",{key:s},u(n.timestamp)+" — "+u(n.status_remarks),1))),128))])]),_.value[a.tracking_id]?(i(),d("div",ue,[...e[3]||(e[3]=[t("i",{class:"fa fa-spinner fa-spin"},null,-1),w(" Uploading file ... ",-1)])])):f.value[a.tracking_id]?(i(),d("div",{key:1,class:F(["px-4 py-2 rounded-md text-xs font-medium flex items-center gap-2",f.value[a.tracking_id].ok?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"])},[t("i",{class:F(f.value[a.tracking_id].ok?"fa fa-check-circle":"fa fa-exclamation-circle")},null,2),t("span",null,u(f.value[a.tracking_id].msg),1)],2)):x("",!0),t("div",pe,[N(a)?(i(),d("div",ge,[e[5]||(e[5]=t("label",{class:"block font-semibold text-xs text-gray-700 mb-1"}," Upload Latest Receipt: ",-1)),t("div",fe,[t("input",{type:"file",onChange:n=>j(n,a),accept:"image/*",class:"w-full text-xs text-gray-600"},null,40,me),e[4]||(e[4]=t("p",{class:"mt-1 text-[11px] text-gray-500"}," Accepted formats: JPG, PNG | Max size: 5MB ",-1))])])):x("",!0),N(a)?(i(),d("div",xe,[e[7]||(e[7]=t("label",{class:"block font-semibold text-xs text-gray-700 mb-1"}," Upload Additional Docs (If Applicable): ",-1)),t("div",ve,[t("input",{type:"file",onChange:n=>z(n,a),accept:"image/*,application/pdf",class:"w-full text-xs text-gray-600"},null,40,_e),e[6]||(e[6]=t("p",{class:"mt-1 text-[11px] text-gray-500"}," Accepted formats: JPG, PNG, PDF | Max size: 5MB to 10 MB ",-1))])])):x("",!0)]),a.follow_up_remarks?(i(),d("div",ye,[a.follow_up_remarks?(i(),d("div",be,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-800 mb-1"}," Latest Response Conversation: ",-1)),t("div",he,[t("div",we,[t("div",ke,[e[8]||(e[8]=t("strong",{class:"block text-gray-700 mb-1"},"Registrar:",-1)),w(" "+u(a.follow_up_remarks),1)])]),a.additional_response_details?(i(),d("div",Te,[t("div",Ce,[e[9]||(e[9]=t("strong",{class:"block text-white/90 mb-1"},"You:",-1)),w(" "+u(a.additional_response_details),1)])])):x("",!0),D(q,{"enter-from":"translate-y-2 opacity-0","enter-to":"translate-y-0 opacity-100","enter-active-class":"transition duration-300 ease-out","leave-from":"translate-y-0 opacity-100","leave-to":"translate-y-2 opacity-0","leave-active-class":"transition duration-200 ease-in"},{default:K(()=>[S.value?(i(),d("div",Se,u(A.value),1)):x("",!0)]),_:1})]),t("div",$e,[O(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=n=>b.value=n),rows:"1",placeholder:"Type your message...",class:"flex-1 text-sm resize-none rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-green-600 focus:border-green-600 transition",onKeyup:Y(Q(n=>I(a),["exact","prevent"]),["enter"])},null,40,De),[[U,b.value]]),t("button",{onClick:n=>I(a),disabled:y.value||!b.value.trim(),class:"bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-800 transition disabled:opacity-50 disabled:cursor-not-allowed"},[y.value?(i(),d("span",Ne,"⏳")):(i(),d("span",Pe,"Send"))],8,Re)])])):x("",!0)])):x("",!0),a.details?(i(),d("div",Ae,[e[11]||(e[11]=t("label",{class:"block font-semibold text-xs text-gray-700 mb-1"},"Details:",-1)),t("div",Ie,u(a.details),1)])):x("",!0),t("div",null,[e[12]||(e[12]=t("label",{class:"block font-semibold text-xs text-gray-700 mb-1"},"Type of Document Request:",-1)),t("div",Oe,[(i(!0),d(R,null,P(a.type_document_requests,(n,s)=>(i(),d("div",{key:s},u(n),1))),128))])]),t("div",Ue,[t("div",null,[e[13]||(e[13]=t("label",{class:"font-semibold text-xs text-gray-700"},"Full Name:",-1)),t("div",Fe,u(a.firstname)+" "+u(a.middlename)+" "+u(a.lastname),1)]),t("div",null,[e[14]||(e[14]=t("label",{class:"font-semibold text-xs text-gray-700"},"College:",-1)),t("div",Je,u(a.college),1)]),t("div",null,[e[15]||(e[15]=t("label",{class:"font-semibold text-xs text-gray-700"},"Course:",-1)),t("div",Me,u(a.course),1)]),t("div",null,[e[16]||(e[16]=t("label",{class:"font-semibold text-xs text-gray-700"},"Year Graduated / Last Attended:",-1)),t("div",je,u(a.year_graduated_last_attended),1)])])])])]))),128))])):x("",!0)]),D(l)])}}},Ke=W(ze,[["__scopeId","data-v-f0646dc9"]]);export{Ke as default};
