import{_ as O}from"./CF46f3p9.js";import{_ as U}from"./C6A0-C8C.js";import{B as F,r as f,e as I,c as d,b as T,f as J,a as e,l as x,d as $,m as j,E as z,F as w,g as k,o as n,t as p,n as D}from"#entry";import"./BLMuvzoS.js";import{_ as B}from"./DlAUqK2U.js";const G={class:"bg-gray-50"},M={class:"border-t-2 border-green-700 shadow-lg lg:my-5 my-3 lg:pb-10 w-11/12 mx-auto"},E={class:"lg:p-5 p-2"},L={class:"flex"},V={class:"flex lg:w-4/12 w-11/12 mx-auto my-3 text-center lg:rounded-lg rounded-md"},H={class:"flex w-full"},q={class:"w-full"},Y={key:0,class:"lg:text-sm text-xs text-red-800 text-center mt-5 py-2 px-4 rounded-sm shadow lg:w-6/12 mx-auto bg-red-100"},K={key:0,class:"px-4 py-2 lg:w-11/12 mx-auto"},Q={class:"border-2 border-gray-200 shadow-md rounded-md overflow-hidden"},W={class:"bg-gray-100 text-green-900 font-bold text-center uppercase text-sm lg:text-base py-2 px-5 border-b"},X={class:"p-4 space-y-4"},Z={class:"list-disc pl-5 text-sm text-gray-800"},ee={key:0,class:"text-gray-600 text-xs flex items-center gap-2"},te={class:"lg:flex gap-3 w-full"},ae={key:0,class:"w-full"},se={class:"border-2 border-dashed border-green-400 p-3 rounded-md bg-green-50"},le=["onChange"],re={key:1,class:"w-full"},ie={class:"border-2 border-dashed border-green-400 p-3 rounded-md bg-green-50"},oe=["onChange"],de={key:2},ne={class:"text-sm text-gray-800 bg-gray-50 p-3 rounded-md border border-gray-200 shadow-sm"},ce={key:3},pe={class:"text-sm text-gray-800"},ue={class:"text-sm text-gray-800 space-y-1"},ge={class:"bg-gray-100 p-4 rounded-md mt-3 space-y-2"},me={class:"text-sm text-gray-800"},fe={class:"text-sm text-gray-800"},xe={class:"text-sm text-gray-800"},be={class:"text-sm text-gray-800"},ve={__name:"index",setup(_e){const N=F(),u=f(N.mainDevServer),C=f([]),_=f(""),b=f([]),y=f(!1),v=f({}),g=f({});I(async()=>{try{const i=await $fetch(u.value+"/api/registrar/list");C.value=i||[]}catch(i){console.error("Fetch error:",i)}});const P=()=>{const i=_.value.trim().toUpperCase();i?(b.value=C.value.filter(t=>t?.tracking_id===i),y.value=b.value.length===0):(b.value=[],y.value=!1)},S=i=>{const t=(i?.logs?.[0]?.status_remarks||"").toLowerCase();return t==="assessment"||t==="preparing documents"};async function A(i,t){const m=i.target.files?.[0];if(!m||!t)return;const r=t.tracking_id;v.value[r]=!0,g.value[r]={ok:!1,msg:""};try{const a=new FormData;a.append("file",m);const o=await $fetch(u.value+"/api/registrar/upload/",{method:"POST",body:a}),c=Array.isArray(o)?o.map(l=>({name:l.name||l.file?.split("/").pop(),url:l.url||l.file})):[{name:o.name||o.file?.split("/").pop(),url:o.url||o.file}],s=await $fetch(`${u.value}/api/registrar/payment/by-tracking/?tracking_id=${encodeURIComponent(r)}`).catch(()=>null);if(s){const l=[...s.receipt_image_url||[],...c],h={payment_id:s.payment_id||"",fullname:s.fullname||"",email:s.email||"",course:s.course||"",college:s.college||"",date_graduated_last_attended:s.date_graduated_last_attended||"",total:s.total||"",detail_fees:JSON.stringify(s.detail_fees||[]),tracking_id:s.tracking_id||r,receipt_image_url:JSON.stringify(l)};await $fetch(`${u.value}/api/registrar/payment/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:h})}else{const l={payment_id:"",fullname:"",email:"",course:"",college:"",date_graduated_last_attended:"",total:"",detail_fees:JSON.stringify([]),tracking_id:r,receipt_image_url:JSON.stringify(c)};await $fetch(u.value+"/api/registrar/payment/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:l})}try{await $fetch(u.value+"/api/registrar/status/confirm-receipt/",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:t.id,latest_status:"Confirm Receipt"}})}catch(l){console.warn("Receipt uploaded, but email notification failed:",l)}g.value[r]={ok:!0,msg:"Receipt uploaded successfully."}}catch(a){console.error("Upload receipt failed",a),g.value[r]={ok:!1,msg:"Failed to upload receipt. Please try again."}}finally{v.value[r]=!1,i.target.value=""}}async function R(i,t){const m=i.target.files?.[0];if(!m||!t)return;const r=t.tracking_id;v.value[r]=!0,g.value[r]={ok:!1,msg:""};try{const a=new FormData;a.append("file",m);const o=await $fetch(u.value+"/api/registrar/upload/",{method:"POST",body:a}),c=Array.isArray(o)?o.map(l=>({name:l.name||l.file?.split("/").pop(),url:l.url||l.file})):[{name:o.name||o.file?.split("/").pop(),url:o.url||o.file}],s=await $fetch(`${u.value}/api/registrar/payment/by-tracking/?tracking_id=${encodeURIComponent(r)}`).catch(()=>null);if(s){const l=[...s.additional_docs_image_url||[],...c],h={payment_id:s.payment_id||"",fullname:s.fullname||"",email:s.email||"",course:s.course||"",college:s.college||"",date_graduated_last_attended:s.date_graduated_last_attended||"",total:s.total||"",detail_fees:JSON.stringify(s.detail_fees||[]),tracking_id:s.tracking_id||r,receipt_image_url:JSON.stringify(s.receipt_image_url||[]),additional_docs_image_url:JSON.stringify(l)};await $fetch(`${u.value}/api/registrar/payment/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:h})}else{const l={payment_id:"",fullname:"",email:"",course:"",college:"",date_graduated_last_attended:"",total:"",detail_fees:JSON.stringify([]),tracking_id:r,receipt_image_url:JSON.stringify([]),additional_docs_image_url:JSON.stringify(c)};await $fetch(u.value+"/api/registrar/payment/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:l})}try{await $fetch(u.value+"/api/registrar/status/confirm-receipt/",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:t.id,latest_status:"Confirm Receipt"}})}catch(l){console.warn("File uploaded, but email notification failed:",l)}g.value[r]={ok:!0,msg:"Additional document uploaded successfully."}}catch(a){console.error("Upload additional docs failed",a),g.value[r]={ok:!1,msg:"Failed to upload additional document. Please try again."}}finally{v.value[r]=!1,i.target.value=""}}return(i,t)=>{const m=O,r=U;return n(),d("div",G,[T(m),t[15]||(t[15]=J('<div class="relative" data-v-3bcb9630><div class="bg-green-700 lg:h-[200px] h-[130px]" data-v-3bcb9630><div class="lg:pt-10 absolute top-1/2 transform -translate-y-1/2 w-full" data-v-3bcb9630><p class="font-bold uppercase text-white lg:text-2xl text-sm w-11/12 mx-auto" data-v-3bcb9630> REGISTRAR </p><p class="text-xs w-11/12 mx-auto text-white" data-v-3bcb9630> Higher Education Registrar Appointment </p></div></div><div class="shadow-lg text-green-700" data-v-3bcb9630><div class="lg:flex justify-between border-b border-gray-200 lg:pl-5" data-v-3bcb9630><div class="flex items-center capitalize text-xs lg:border-b-0 border-b lg:px-0 px-1.5 py-2" data-v-3bcb9630><div data-v-3bcb9630><a href="/registrar" class="mr-2 hover:underline lg:h-10" data-v-3bcb9630>Home</a></div><div data-v-3bcb9630><i class="fas fa-caret-right" data-v-3bcb9630></i><a href="/registrar/heu/appointment" class="mx-2 hover:underline lg:h-10" data-v-3bcb9630>HEU Appointment</a></div></div><div class="flex hover:text-green-800 text-white bg-white h-full" data-v-3bcb9630><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-3bcb9630><a href="/registrar" class="flex items-center w-fit mx-auto" data-v-3bcb9630><i class="fa fa-video-camera" aria-hidden="true" data-v-3bcb9630></i><span class="ml-3 whitespace-nowrap" data-v-3bcb9630>Demo Guide</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-3bcb9630><a href="/registrar/track" class="flex items-center w-fit mx-auto" data-v-3bcb9630><i class="fa fa-universal-access" aria-hidden="true" data-v-3bcb9630></i><span class="ml-3 whitespace-nowrap" data-v-3bcb9630>Track</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full" data-v-3bcb9630><a href="/registrar/login" class="flex items-center w-fit mx-auto" data-v-3bcb9630><i class="fa fa-user" aria-hidden="true" data-v-3bcb9630></i><span class="ml-3 whitespace-nowrap" data-v-3bcb9630>Admin Login</span></a></div></div></div></div></div>',1)),e("div",M,[t[14]||(t[14]=e("h2",{class:"lg:text-base text-xs px-10 uppercase py-2 font-bold bg-green-900 text-white text-center"},[e("i",{class:"fa fa-certificate text-white mr-2"}),$(" Appointment Tracker ")],-1)),e("div",E,[e("div",L,[e("div",V,[e("div",H,[e("div",q,[j(e("input",{class:"py-1.5 pl-2 pr-2 uppercase w-full border-2 border-green-700 rounded-tl-md rounded-bl-md text-xs",placeholder:"Enter 20-digit Tracking ID","onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),maxlength:"20"},null,512),[[z,_.value]])]),e("div",null,[e("button",{class:"bg-green-700 hover:bg-green-800 text-white text-xs px-4 py-[7.7px] rounded-tr-md rounded-br-md",onClick:P}," Track ")])])])]),y.value?(n(),d("div",Y," Can't find Tracking ID! ")):x("",!0)]),b.value.length>0?(n(),d("div",K,[(n(!0),d(w,null,k(b.value,(a,o)=>(n(),d("div",{key:o,class:"mb-6"},[e("div",Q,[e("h2",W," Tracking ID: "+p(a.tracking_id),1),e("div",X,[e("div",null,[t[1]||(t[1]=e("label",{class:"block font-semibold text-xs text-gray-700 mb-1"},"Status:",-1)),e("ul",Z,[(n(!0),d(w,null,k(a.logs,(c,s)=>(n(),d("li",{key:s},p(c.timestamp)+" â€” "+p(c.status_remarks),1))),128))])]),v.value[a.tracking_id]?(n(),d("div",ee,[...t[2]||(t[2]=[e("i",{class:"fa fa-spinner fa-spin"},null,-1),$(" Uploading file ... ",-1)])])):g.value[a.tracking_id]?(n(),d("div",{key:1,class:D(["px-4 py-2 rounded-md text-xs font-medium flex items-center gap-2",g.value[a.tracking_id].ok?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"])},[e("i",{class:D(g.value[a.tracking_id].ok?"fa fa-check-circle":"fa fa-exclamation-circle")},null,2),e("span",null,p(g.value[a.tracking_id].msg),1)],2)):x("",!0),e("div",te,[S(a)?(n(),d("div",ae,[t[4]||(t[4]=e("label",{class:"block font-semibold text-xs text-gray-700 mb-1"}," Upload Latest Receipt: ",-1)),e("div",se,[e("input",{type:"file",onChange:c=>A(c,a),accept:"image/*",class:"w-full text-xs text-gray-600"},null,40,le),t[3]||(t[3]=e("p",{class:"mt-1 text-[11px] text-gray-500"}," Accepted formats: JPG, PNG | Max size: 5MB ",-1))])])):x("",!0),S(a)?(n(),d("div",re,[t[6]||(t[6]=e("label",{class:"block font-semibold text-xs text-gray-700 mb-1"}," Upload Additional Docs (If Applicable): ",-1)),e("div",ie,[e("input",{type:"file",onChange:c=>R(c,a),accept:"image/*,application/pdf",class:"w-full text-xs text-gray-600"},null,40,oe),t[5]||(t[5]=e("p",{class:"mt-1 text-[11px] text-gray-500"}," Accepted formats: JPG, PNG, PDF | Max size: 5MB to 10 MB ",-1))])])):x("",!0)]),a.follow_up_remarks?(n(),d("div",de,[t[7]||(t[7]=e("label",{class:"block font-semibold text-xs text-gray-700 mb-1"}," Follow Up Remarks: ",-1)),e("div",ne,p(a.follow_up_remarks),1)])):x("",!0),a.details?(n(),d("div",ce,[t[8]||(t[8]=e("label",{class:"block font-semibold text-xs text-gray-700 mb-1"},"Details:",-1)),e("div",pe,p(a.details),1)])):x("",!0),e("div",null,[t[9]||(t[9]=e("label",{class:"block font-semibold text-xs text-gray-700 mb-1"},"Type of Document Request:",-1)),e("div",ue,[(n(!0),d(w,null,k(a.type_document_requests,(c,s)=>(n(),d("div",{key:s},p(c),1))),128))])]),e("div",ge,[e("div",null,[t[10]||(t[10]=e("label",{class:"font-semibold text-xs text-gray-700"},"Full Name:",-1)),e("div",me,p(a.firstname)+" "+p(a.middlename)+" "+p(a.lastname),1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"font-semibold text-xs text-gray-700"},"College:",-1)),e("div",fe,p(a.college),1)]),e("div",null,[t[12]||(t[12]=e("label",{class:"font-semibold text-xs text-gray-700"},"Course:",-1)),e("div",xe,p(a.course),1)]),e("div",null,[t[13]||(t[13]=e("label",{class:"font-semibold text-xs text-gray-700"},"Year Graduated / Last Attended:",-1)),e("div",be,p(a.year_graduated_last_attended),1)])])])])]))),128))])):x("",!0)]),T(r)])}}},Se=B(ve,[["__scopeId","data-v-3bcb9630"]]);export{Se as default};
