import{j as re,r as x,e as ae,I as ue,c as i,a as s,i as p,t as P,d as de,q as m,z as V,n as R,F as W,g as pe,o as r,M as ce,s as B,A as w,f as z}from"#entry";import{h as X}from"./BLMuvzoS.js";const _e={class:"relative w-full h-screen bg-gray-100 p-4 select-none overflow-x-hidden"},me={class:"flex gap-2 mb-4 items-center"},fe={class:"ml-4 flex items-center gap-2"},ge=["onMousedown"],ve={class:"flex bg-black p-2"},he={class:"flex gap-2 items-center"},ye=["onMousedown"],xe=["onUpdate:modelValue","onChange"],we={class:"flex gap-2 w-full"},ke=["onUpdate:modelValue","onChange"],Se=["onUpdate:modelValue","onChange"],Ce=["onUpdate:modelValue","onChange"],Ue=["onUpdate:modelValue","onChange"],Ve=["onChange"],ze=["onUpdate:modelValue","onFocus"],Me=["value","onInput"],Be=["onUpdate:modelValue"],Ie=["onClick"],Te={class:"w-full h-auto"},$e=["onUpdate:modelValue","readonly"],Ne=["src"],De=["src"],Le=["src"],Fe=["onMousedown"],Oe={__name:"index",setup(Ae){const Y=re(),v=x(Y.mainDevServer),g=x(!1),c=x("page1"),l=x([]),h=x({show:!1,message:"",type:"success"});let M=10;function f(n,o="success"){h.value={show:!0,message:n,type:o},setTimeout(()=>h.value.show=!1,3e3)}ae(()=>I());async function I(){try{const n=await fetch(`${v.value}/api/cms/boxes/?page=${c.value}`);if(!n.ok){l.value=[];return}const o=await n.json(),e=Array.isArray(o?.boxes)?o.boxes:[];l.value=e.map(t=>{let a=Array.isArray(t.file_url)?t.file_url:t.file_url?[{url:t.file_url}]:[];t.component_type&&t.component_type!=="text"&&(!a||!a.length)&&t.component_content&&(a=[{url:String(t.component_content)}]);const u=t.component_design_styles||"",_=u.split(" ").filter(Boolean),U=_.find(d=>d.startsWith("text-"))||"",le=_.find(d=>d.startsWith("text-")&&d!==U&&(d.includes("xl")||d.includes("base")||d.includes("sm")))||"",se=_.find(d=>d.startsWith("font-"))||"",ie=_.find(d=>d.startsWith("rounded-"))||"";return{file_url:a,component_design_styles:u,zIndex:++M,cms_id:t.cms_id||"CMS"+X().valueOf(),component_width:Number(t.component_width)||700,component_height:Number(t.component_height)||100,component_top:Number(t.component_top)||100,component_left:Number(t.component_left)||100,component_type:t.component_type||"text",component_content:t.component_content||"",page_route_link_belong:t.page_route_link_belong||c.value,status:t.status||"",component_design_styles_color:U,component_design_styles_size:le,component_design_styles_weight:se,component_design_styles_shape:ie}})}catch(n){console.error("loadBoxes error:",n),l.value=[]}}const J=ue(()=>l.value.filter(n=>n.page_route_link_belong===c.value));function G(){l.value.push({cms_id:"CMS"+X().valueOf(),component_width:700,component_height:100,component_top:100,component_left:100,component_type:"text",component_content:"",component_design_styles:"",file_url:[],page_route_link_belong:c.value,zIndex:++M,status:"",component_design_styles_color:"",component_design_styles_size:"",component_design_styles_weight:"",component_design_styles_shape:""})}function y(n){(!Array.isArray(n.file_url)||!n.file_url.length)&&(n.file_url=[{url:""}])}async function q(n,o){const e=n.target.files[0];if(!e)return;const t=new FormData;t.append("file",e);try{const u=await(await fetch(`${v.value}/api/cms/upload-file/`,{method:"POST",body:t})).json(),_=l.value.findIndex(U=>U.cms_id===o);if(_===-1)return;y(l.value[_]),l.value[_].file_url[0].url=u.storage_url||u.url||"",l.value[_].file_url[0].name=u.name||e.name}catch(a){console.error("upload error",a),f("File upload failed","error")}}function H(n,o){const e=n.target.value,t=l.value.findIndex(a=>a.cms_id===o);if(t!==-1)try{const a=new URL(e);let u="";a.hostname.includes("youtube.com")?u=a.searchParams.get("v"):a.hostname.includes("youtu.be")&&(u=a.pathname.substring(1)),y(l.value[t]),l.value[t].file_url[0].url=u?`https://www.youtube.com/embed/${u}`:e,l.value[t].file_url[0].name=u?`youtube-${u}`:"video",l.value[t].component_type="video",l.value[t].component_content=""}catch{y(l.value[t]),l.value[t].file_url[0].url=e,l.value[t].file_url[0].name="video",l.value[t].component_type="video",l.value[t].component_content=""}}function K(n){return n.file_url&&n.file_url[0]&&n.file_url[0].url||""}async function Q(){const n=l.value.map(o=>{const e=o.component_type==="text",t=Array.isArray(o.file_url)?o.file_url:o.file_url?[{url:o.file_url}]:[];return{cms_id:o.cms_id,component_width:String(o.component_width||""),component_height:String(o.component_height||""),component_top:String(o.component_top||""),component_left:String(o.component_left||""),component_type:o.component_type||"text",component_content:e&&o.component_content||"",component_design_styles:o.component_design_styles||[o.component_design_styles_color,o.component_design_styles_size,o.component_design_styles_weight,o.component_design_styles_shape].filter(Boolean).join(" "),file_url:e?[]:t,page_route_link_belong:o.page_route_link_belong||c.value}});try{const o=await fetch(`${v.value}/api/cms/boxes/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok){console.error(await o.text()),f("Save failed","error");return}const e=await o.json();f(e.message||"Saved successfully!"),I()}catch(o){console.error(o),f("Save failed","error")}}async function Z(n){const o=l.value.findIndex(t=>t.cms_id===n);if(o===-1)return;const e=l.value.splice(o,1)[0];try{(await fetch(`${v.value}/api/cms/boxes/delete/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cms_id:n})})).ok||l.value.push(e),f("Box deleted")}catch(t){console.error(t),l.value.push(e),f("Delete failed","error")}}async function b(){const n=l.value.filter(e=>e.page_route_link_belong===c.value);if(!n.length)return;l.value=l.value.filter(e=>e.page_route_link_belong!==c.value);const o=n.map(e=>e.cms_id);try{(await fetch(`${v.value}/api/cms/boxes/delete-multiple/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cms_ids:o})})).ok||l.value.push(...n),f("All boxes deleted")}catch(e){console.error(e),l.value.push(...n),f("Delete failed","error")}}let k=null,T=0,$=0;function ee(n,o){k=o;const e=l.value.find(t=>t.cms_id===o);T=n.clientX-(Number(e.component_left)||0),$=n.clientY-(Number(e.component_top)||0),window.addEventListener("mousemove",N),window.addEventListener("mouseup",D)}function N(n){if(!k)return;const o=l.value.find(e=>e.cms_id===k);o.component_left=n.clientX-T,o.component_top=n.clientY-$}function D(){k=null,window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",D)}let S=null,L=0,F=0,A=0,E=0;function te(n,o){S=o;const e=l.value.find(t=>t.cms_id===o);L=Number(e.component_width)||0,F=Number(e.component_height)||0,A=n.clientX,E=n.clientY,window.addEventListener("mousemove",j),window.addEventListener("mouseup",O)}function j(n){if(!S)return;const o=l.value.find(e=>e.cms_id===S);o.component_width=Math.max(40,L+(n.clientX-A)),o.component_height=Math.max(40,F+(n.clientY-E))}function O(){S=null,window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",O)}function oe(n){g.value&&(n.zIndex=++M)}function ne(n){n.component_type!=="text"&&(y(n),(!n.file_url||!n.file_url.length||!n.file_url[0].url)&&n.component_content&&(n.file_url[0].url=n.component_content,n.file_url[0].name="migrated"),n.component_content="")}function C(n){const o=[n.component_design_styles_color,n.component_design_styles_size,n.component_design_styles_weight,n.component_design_styles_shape].filter(Boolean);n.component_design_styles=o.join(" ")}return(n,o)=>(r(),i("div",_e,[s("div",me,[s("button",{class:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",onClick:G}," Add Box "),s("button",{class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:o[0]||(o[0]=e=>g.value=!g.value)},P(g.value?"Disable Edit Mode":"Enable Edit Mode"),1),s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:Q}," Save Boxes "),s("button",{class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:b}," Delete All Boxes "),s("div",fe,[o[3]||(o[3]=de(" Current Page: ",-1)),m(s("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e),class:"border rounded px-1 w-32"},null,512),[[V,c.value]])])]),h.value.show?(r(),i("div",{key:0,class:R(["fixed top-4 right-4 px-4 py-2 rounded shadow text-white",h.value.type==="success"?"bg-green-600":"bg-red-600"])},P(h.value.message),3)):p("",!0),(r(!0),i(W,null,pe(J.value,e=>(r(),i("div",{key:e.cms_id,class:R(["absolute border border-purple-600 rounded-md shadow-md bg-white",e.component_design_styles]),style:ce({width:(e.component_width||240)+"px",height:(e.component_height||180)+"px",top:(e.component_top||100)+"px",left:(e.component_left||100)+"px",zIndex:e.zIndex||1}),onMousedown:t=>oe(e)},[g.value?(r(),i("div",{key:0,class:"absolute -top-14 left-0 flex w-full z-50",onMousedown:o[2]||(o[2]=B(()=>{},["stop"]))},[s("div",ve,[s("div",he,[s("div",{class:"px-2 py-1 bg-purple-600 text-white text-xs cursor-move rounded",onMousedown:B(t=>ee(t,e.cms_id),["stop"])}," Drag ",40,ye),m(s("select",{"onUpdate:modelValue":t=>e.component_type=t,class:"border rounded px-1 text-sm",onChange:t=>ne(e)},[...o[4]||(o[4]=[z('<option value="text">Text</option><option value="image">Image</option><option value="image_link">Image Link</option><option value="video">Video</option><option value="file">File</option>',5)])],40,xe),[[w,e.component_type]])]),s("div",we,[e.component_type==="text"?(r(),i(W,{key:0},[m(s("select",{"onUpdate:modelValue":t=>e.component_design_styles_color=t,class:"border rounded px-1 text-sm",onChange:t=>C(e)},[...o[5]||(o[5]=[z('<option value="">Default Color</option><option value="text-green-600">Green</option><option value="text-black">Black</option><option value="text-white">White</option><option value="text-gray-600">Gray</option>',5)])],40,ke),[[w,e.component_design_styles_color]]),m(s("select",{"onUpdate:modelValue":t=>e.component_design_styles_size=t,class:"border rounded px-1 text-sm",onChange:t=>C(e)},[...o[6]||(o[6]=[z('<option value="">Font Size</option><option value="text-2xl">Title</option><option value="text-xl">Subtitle</option><option value="text-base">Paragraph</option><option value="text-sm">Small Caption</option>',5)])],40,Se),[[w,e.component_design_styles_size]]),m(s("select",{"onUpdate:modelValue":t=>e.component_design_styles_weight=t,class:"border rounded px-1 text-sm",onChange:t=>C(e)},[...o[7]||(o[7]=[s("option",{value:""},"Font Weight",-1),s("option",{value:"font-light"},"Light",-1),s("option",{value:"font-normal"},"Normal",-1),s("option",{value:"font-bold"},"Bold",-1)])],40,Ce),[[w,e.component_design_styles_weight]])],64)):e.component_type==="image"||e.component_type==="image_link"?m((r(),i("select",{key:1,"onUpdate:modelValue":t=>e.component_design_styles_shape=t,class:"border rounded px-1 text-sm",onChange:t=>C(e)},[...o[8]||(o[8]=[z('<option value="">Default Shape</option><option value="rounded-full">Round Full</option><option value="rounded-sm">Round Sm</option><option value="rounded-md">Round Md</option><option value="rounded-lg">Round Lg</option><option value="rounded-xl">Round Xl</option>',6)])],40,Ue)),[[w,e.component_design_styles_shape]]):p("",!0)]),e.component_type==="image"||e.component_type==="file"?(r(),i("input",{key:0,type:"file",onChange:t=>q(t,e.cms_id)},null,40,Ve)):p("",!0),e.component_type==="image_link"?m((r(),i("input",{key:1,type:"url","onUpdate:modelValue":t=>e.file_url[0].url=t,class:"border rounded px-1 w-40",placeholder:"Image URL",onFocus:t=>y(e)},null,40,ze)),[[V,e.file_url[0].url]]):p("",!0),e.component_type==="video"?(r(),i("input",{key:2,type:"url",value:K(e),onInput:t=>H(t,e.cms_id),class:"border rounded px-1 w-40",placeholder:"YouTube URL"},null,40,Me)):p("",!0),m(s("input",{type:"text","onUpdate:modelValue":t=>e.page_route_link_belong=t,class:"border rounded px-1 text-sm w-32",placeholder:"page1"},null,8,Be),[[V,e.page_route_link_belong]]),s("button",{class:"px-2 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700",onClick:t=>Z(e.cms_id)}," Delete ",8,Ie)])],32)):p("",!0),s("div",Te,[e.component_type==="text"?m((r(),i("textarea",{key:0,"onUpdate:modelValue":t=>e.component_content=t,class:"w-full h-auto whitespace-pre-wrap",readonly:!g.value||e.status==="disabled"},null,8,$e)),[[V,e.component_content]]):p("",!0),["image","image_link"].includes(e.component_type)&&e.file_url.length&&e.file_url[0].url?(r(),i("img",{key:1,src:e.file_url[0].url,class:"w-full h-auto object-contain"},null,8,Ne)):p("",!0),e.component_type==="video"&&e.file_url.length&&e.file_url[0].url?(r(),i("iframe",{key:2,src:e.file_url[0].url,class:"w-full h-64",frameborder:"0",allowfullscreen:""},null,8,De)):p("",!0),e.component_type==="file"&&e.file_url.length&&e.file_url[0].url?(r(),i("iframe",{key:3,src:e.file_url[0].url,class:"w-full h-auto"},null,8,Le)):p("",!0)]),g.value?(r(),i("div",{key:1,class:"absolute bottom-0 right-0 w-4 h-4 bg-purple-600 cursor-se-resize rounded-br",onMousedown:B(t=>te(t,e.cms_id),["stop"])},null,40,Fe)):p("",!0)],46,ge))),128))]))}};export{Oe as default};
