import{k as x,r as u,h as k,I as M,c as n,a as i,t as m,F as U,f as I,O as V,o as l,M as F,j as r,s as c,g as _,A as z,e as C,z as f}from"#entry";import{h as S}from"./BLMuvzoS.js";const N={class:"relative w-full h-screen p-4 select-none overflow-x-hidden"},A={class:"flex gap-2 mb-4 items-center"},B={class:"ml-4 flex items-center gap-2"},D=["onMousedown"],R=["onMousedown"],$=["onUpdate:modelValue","onChange"],L=["onUpdate:modelValue"],T=["onChange"],j=["onUpdate:modelValue","onFocus"],E=["onInput"],P={class:"w-full h-full p-2 overflow-hidden"},O={key:0,class:"w-full h-full whitespace-pre-wrap"},Y=["src"],q=["src"],G=["src"],H=["onMousedown"],W={__name:"preview",setup(J){V();const h=x(),g=u(h.mainDevServer),p=u(!1),d=u("page1"),a=u([]);let v=10;k(()=>w());async function w(){try{const t=await fetch(`${g.value}/api/cms/boxes/`);if(!t.ok){a.value=[];return}const s=await t.json(),e=Array.isArray(s?.boxes)?s.boxes:[];a.value=e.map(o=>({file_url:Array.isArray(o.file_url)?o.file_url:o.file_url?[{url:o.file_url}]:[],component_properties:o.component_properties||{},zIndex:++v,cms_id:o.cms_id||"CMS"+S().valueOf(),component_width:Number(o.component_width)||240,component_height:Number(o.component_height)||180,component_top:Number(o.component_top)||100,component_left:Number(o.component_left)||100,component_type:o.component_type||"text",component_content:o.component_content||"",page_route_link_belong:o.page_route_link_belong||d.value}))}catch(t){console.error("loadBoxes error:",t),a.value=[]}}const y=M(()=>a.value.filter(t=>t.page_route_link_belong===d.value));return(t,s)=>(l(),n("div",N,[i("div",A,[i("div",B," Assign Route Page: "+m(d.value),1)]),(l(!0),n(U,null,I(y.value,e=>(l(),n("div",{key:e.cms_id,class:"absolute rounded-md bg-white",style:F({width:(e.component_width||240)+"px",height:(e.component_height||180)+"px",top:(e.component_top||100)+"px",left:(e.component_left||100)+"px",zIndex:e.zIndex||1}),onMousedown:o=>t.bringToFront(e),onClick:s[1]||(s[1]=o=>!p.value)},[p.value?(l(),n("div",{key:0,class:"absolute -top-14 left-0 w-full bg-white shadow-md rounded p-2 flex gap-2 items-center z-50",onMousedown:s[0]||(s[0]=c(()=>{},["stop"]))},[i("div",{class:"px-2 py-1 bg-purple-600 text-white text-xs cursor-move rounded",onMousedown:c(o=>t.startDrag(o,e.cms_id),["stop"])}," Drag ",40,R),_(i("select",{"onUpdate:modelValue":o=>e.component_type=o,class:"border rounded px-1 text-sm",onChange:o=>t.ensureFileUrl(e)},[...s[2]||(s[2]=[C('<option value="text">Text</option><option value="image">Image</option><option value="image_link">Image Link</option><option value="video">Video</option><option value="file">File</option>',5)])],40,$),[[z,e.component_type]]),_(i("input",{type:"text","onUpdate:modelValue":o=>e.page_route_link_belong=o,class:"border rounded px-1 text-sm w-32",placeholder:"page1"},null,8,L),[[f,e.page_route_link_belong]]),e.component_type==="image"||e.component_type==="file"?(l(),n("input",{key:0,type:"file",onChange:o=>t.handleFileUpload(o,e.cms_id)},null,40,T)):r("",!0),e.component_type==="image_link"?_((l(),n("input",{key:1,type:"url","onUpdate:modelValue":o=>e.file_url[0].url=o,class:"border rounded px-1 w-40",placeholder:"Image URL",onFocus:o=>t.ensureFileUrl(e)},null,40,j)),[[f,e.file_url[0].url]]):r("",!0),e.component_type==="video"?(l(),n("input",{key:2,type:"url",onInput:o=>t.onVideoInput(o,e.cms_id),class:"border rounded px-1 w-40",placeholder:"YouTube URL"},null,40,E)):r("",!0)],32)):r("",!0),i("div",P,[e.component_type==="text"?(l(),n("div",O,m(e.component_content),1)):r("",!0),["image","image_link"].includes(e.component_type)&&e.file_url.length&&e.file_url[0].url?(l(),n("img",{key:1,src:e.file_url[0].url,class:"w-full h-full object-contain"},null,8,Y)):r("",!0),e.component_type==="video"&&e.component_properties.videoEmbed?(l(),n("iframe",{key:2,src:e.component_properties.videoEmbed,class:"w-full h-64",frameborder:"0",allowfullscreen:""},null,8,q)):r("",!0),e.component_type==="file"&&e.file_url.length&&e.file_url[0].url?(l(),n("iframe",{key:3,src:e.file_url[0].url,class:"w-full h-full"},null,8,G)):r("",!0)]),p.value?(l(),n("div",{key:1,class:"absolute bottom-0 right-0 w-4 h-4 bg-purple-600 cursor-se-resize rounded-br",onMousedown:c(o=>t.startResize(o,e.cms_id),["stop"])},null,40,H)):r("",!0)],44,D))),128))]))}};export{W as default};
