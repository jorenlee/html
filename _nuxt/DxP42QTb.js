import{_ as X}from"./DiQUzcr9.js";import{_ as Z}from"./Cl_p_ECO.js";import{x as ee,r as i,e as te,c as r,b as U,f as se,a as e,i as x,d as f,m as V,z as H,F as m,g as y,o as l,t as o,n as v,w as ae,T as re,ai as le,p as ne}from"#entry";import{h as Y}from"./BLMuvzoS.js";import{_ as oe}from"./DlAUqK2U.js";const ie={class:"bg-gray-50"},de={class:"w-11/12 mx-auto my-6"},ce={class:"bg-white shadow-md border-2 border-gray-200"},ue={class:"p-4"},pe={class:"flex flex-col lg:flex-row gap-3 items-center"},ge={class:"flex-1 w-full"},xe={class:"relative"},fe={key:0,class:"mt-4 text-sm text-red-700 bg-red-50 border-2 border-red-300 py-2 px-4 flex items-center gap-2"},ve={key:0,class:"w-11/12 mx-auto mb-8"},be={class:"bg-white shadow-lg overflow-hidden border-2 border-gray-200"},_e={class:"bg-green-700 px-4 py-3 border-b-2 border-green-800"},he={class:"flex items-center justify-between"},me={class:"text-white font-semibold text-sm lg:text-base uppercase"},ye={class:"bg-green-800 text-white text-xs px-3 py-1 font-medium"},we={class:"p-4"},ke={class:"grid lg:grid-cols-2 gap-4"},Ae={class:"space-y-3"},Me={class:"bg-green-50 p-3 border-2 border-green-200"},De={class:"space-y-1.5 text-xs"},Te={class:"flex"},Ie={class:"text-gray-900 font-medium"},Ce={class:"flex"},Ne={class:"text-gray-900"},je={class:"flex"},Re={class:"text-gray-900"},Ue={class:"flex"},Ye={class:"text-gray-900"},$e={class:"bg-gray-50 p-3 border-2 border-gray-200"},Se={class:"space-y-1.5"},Ee={class:"text-gray-600"},Fe={class:"text-gray-900 font-medium ml-1"},Pe={class:"bg-blue-50 p-3 border-2 border-blue-200"},ze={class:"space-y-1"},Ve={class:"text-gray-900"},He={key:0,class:"bg-yellow-50 p-3 border-2 border-yellow-200"},qe={class:"text-xs text-gray-900"},Be={class:"space-y-3"},Ke={key:0,class:"bg-blue-50 border-2 border-blue-300 px-3 py-2 text-xs flex items-center gap-2"},Le={class:"bg-white border-2 border-gray-200 overflow-hidden"},Oe={key:0,class:"px-3 pt-2 bg-gray-100 border-b-2 border-gray-300"},Ge={class:"flex overflow-x-auto"},Je=["src"],Qe={key:1,class:"w-10 h-10 bg-blue-100 rounded flex items-center justify-center mb-1"},We={key:0,class:"fa fa-file-pdf-o text-2xl text-red-600"},Xe={key:1,class:"fa fa-file-word-o text-2xl text-blue-600"},Ze={key:2,class:"fa fa-file-o text-2xl text-gray-600"},et={class:"p-3 bg-gray-50 max-h-[250px] overflow-y-auto space-y-3"},tt={key:1,class:"text-center py-6"},st={key:0,class:"bg-green-700 text-white text-xs px-3 py-1.5 shadow-lg text-center border-2 border-green-800"},at={class:"p-2 bg-white border-t-2 border-gray-300"},rt=["onChange"],lt={class:"flex gap-2"},nt=["onKeyup"],ot=["onClick"],it=["onClick","disabled"],dt={key:0,class:"fa fa-paper-plane"},ct={key:1,class:"fa fa-spinner fa-spin"},ut={key:0,class:"mt-2 space-y-1"},pt={class:"flex items-center gap-1 flex-1 min-w-0"},gt={class:"truncate"},xt={class:"font-semibold text-gray-600 ml-2"},ft={key:1,class:"mt-2 text-[10px]"},vt={key:0,class:"fa fa-spinner fa-spin"},bt={key:1,class:"fa fa-check-circle"},_t={key:2,class:"fa fa-exclamation-circle"},ht={__name:"index",setup(mt){const q=ee(),w=i(q.mainDevServer),b=i([]),C=i(""),k=i([]),N=i(!1),B=i({}),A=i({});te(async()=>{try{const n=await $fetch(w.value+"/api/registrar/list");b.value=$(n||[])}catch(n){console.error("Fetch error:",n)}});const K=n=>{if(!n)return"";const s=n.match(/^(.*?\.(?:jpg|jpeg|png))/i);return s?s[1]:n},$=n=>{if(!Array.isArray(n)||n.length===0)return n;const s=t=>{const u=t?.additional_response_details;return!u||!Array.isArray(u)||u.length===0?!1:u.some(a=>a?.message&&a.message!=="N/A")},d=new Map;return n.forEach(t=>{if(t?.tracking_id){const u=d.get(t.tracking_id);if(!u)d.set(t.tracking_id,t);else{const a=s(u),p=s(t);p&&!a?d.set(t.tracking_id,t):!p&&a||t.id>u.id&&d.set(t.tracking_id,t)}}}),Array.from(d.values())},L=()=>{const n=C.value.trim().toUpperCase();if(n){const s=b.value.filter(d=>d?.tracking_id===n);k.value=$(s),N.value=k.value.length===0}else k.value=[],N.value=!1},O=i(""),j=i(""),M=i(!1),S=i(""),R=i(!1),_=i(""),E=async n=>{if(_.value.trim()){j.value="",O.value="",M.value=!0;try{const s={sender:n.firstname||"User",message:_.value.trim(),timestamp:Y().format("MMMM DD, YYYY h:mm:ss A")},c=[...Array.isArray(n.additional_response_details)?n.additional_response_details.filter(a=>a.message!=="N/A"):[],s],t={...n,additional_response_details:c};await $fetch(`${w.value}/api/registrar/${n.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t}),await $fetch(`${w.value}/api/registrar/status/update/`,{method:"POST",headers:{"Content-Type":"application/json"},body:{id:n.id,latest_status:n.latest_status||""}}),n.additional_response_details=c;const u=b.value.findIndex(a=>a.id===n.id);return u!==-1&&(b.value[u].additional_response_details=c),S.value="✅ Message submitted successfully!",R.value=!0,setTimeout(()=>R.value=!1,3e3),M.value=!1,_.value="",!0}catch(s){return console.error("Error updating response:",s),j.value="❌ Failed to update record.",setTimeout(()=>j.value="",3e3),M.value=!1,!1}}},F=i({}),D=i({}),g=i({}),G=n=>{const s=F.value[n];s&&s.click()},J=async(n,s)=>{const d=Array.from(n.target.files||[]),c=s.tracking_id;if(d.length!==0){D.value[c]=d,g.value[c]="Uploading attachments...";try{const t=[];for(const T of d){const z=new FormData;z.append("file",T);const h=await $fetch(w.value+"/api/registrar/upload/",{method:"POST",body:z}),W=Array.isArray(h)?h.map(I=>({name:I.name||I.file?.split("/").pop(),url:I.url||I.file,timestamp:Y().format("MMMM DD, YYYY h:mm:ss A")})):[{name:h.name||h.file?.split("/").pop(),url:h.url||h.file,timestamp:Y().format("MMMM DD, YYYY h:mm:ss A")}];t.push(...W)}const p=[...(s.additional_documents||[]).filter(T=>T.name!=="N/A"),...t],Q={...s,additional_documents:p};await $fetch(`${w.value}/api/registrar/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:Q}),s.additional_documents=p;const P=b.value.findIndex(T=>T.id===s.id);P!==-1&&(b.value[P].additional_documents=p),g.value[c]="✅ Upload successful!",setTimeout(()=>{g.value[c]="",D.value[c]=[]},3e3)}catch(t){console.error("Attachment upload error:",t),g.value[c]="❌ Upload failed. Please try again.",setTimeout(()=>{g.value[c]=""},5e3)}n.target.value=""}};return(n,s)=>{const d=X,c=Z;return l(),r("div",ie,[U(d),s[24]||(s[24]=se('<div class="relative" data-v-81b15956><div class="bg-green-700 lg:h-[200px] h-[130px]" data-v-81b15956><div class="lg:pt-10 absolute top-1/2 transform -translate-y-1/2 w-full" data-v-81b15956><p class="font-bold uppercase text-white lg:text-2xl text-sm w-11/12 mx-auto" data-v-81b15956> REGISTRAR </p><p class="text-xs w-11/12 mx-auto text-white" data-v-81b15956> Appointment Tracker </p></div></div><div class="shadow-lg text-green-700" data-v-81b15956><div class="lg:flex justify-between border-b border-gray-200 lg:pl-5" data-v-81b15956><div class="flex items-center capitalize text-xs lg:border-b-0 border-b lg:px-0 px-1.5 py-2" data-v-81b15956><div data-v-81b15956><a href="/registrar" class="mr-2 hover:underline lg:h-10" data-v-81b15956>Home</a></div><div data-v-81b15956><i class="fas fa-caret-right" data-v-81b15956></i><a href="/registrar/heu/appointment" class="mx-2 hover:underline lg:h-10" data-v-81b15956>HEU Appointment</a><i class="fas fa-caret-right" data-v-81b15956></i><a href="/registrar/track" class="mx-2 hover:underline lg:h-10" data-v-81b15956>Track</a></div></div><div class="flex hover:text-green-800 text-white bg-white h-full" data-v-81b15956><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-81b15956><a href="/registrar" class="flex items-center w-fit mx-auto" data-v-81b15956><i class="fa fa-video-camera" aria-hidden="true" data-v-81b15956></i><span class="ml-3 whitespace-nowrap" data-v-81b15956>Demo Guide</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-81b15956><a href="/registrar/track" class="flex items-center w-fit mx-auto" data-v-81b15956><i class="fa fa-universal-access" aria-hidden="true" data-v-81b15956></i><span class="ml-3 whitespace-nowrap" data-v-81b15956>Track</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full" data-v-81b15956><a href="/registrar/login" class="flex items-center w-fit mx-auto" data-v-81b15956><i class="fa fa-user" aria-hidden="true" data-v-81b15956></i><span class="ml-3 whitespace-nowrap" data-v-81b15956>Admin Login</span></a></div></div></div></div></div>',1)),e("div",de,[e("div",ce,[s[5]||(s[5]=e("h2",{class:"bg-white text-green-700 text-center uppercase py-2 px-5 font-bold text-sm lg:text-base"},[e("i",{class:"fa fa-certificate mr-2"}),f("Appointment Tracker ")],-1)),e("div",ue,[e("div",pe,[e("div",ge,[e("div",xe,[V(e("input",{class:"w-full py-2.5 pl-10 pr-3 uppercase border-2 border-green-700 text-sm focus:ring-0 focus:border-green-800 transition",placeholder:"Enter 20-digit Tracking ID","onUpdate:modelValue":s[0]||(s[0]=t=>C.value=t),maxlength:"20"},null,512),[[H,C.value]]),s[2]||(s[2]=e("i",{class:"fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-green-700"},null,-1))])]),e("button",{class:"bg-green-700 hover:bg-green-800 text-white px-6 py-2.5 text-sm font-medium transition shadow-sm hover:shadow w-full lg:w-auto",onClick:L},[...s[3]||(s[3]=[e("i",{class:"fa fa-search mr-2"},null,-1),f("Track Now ",-1)])])]),N.value?(l(),r("div",fe,[...s[4]||(s[4]=[e("i",{class:"fa fa-exclamation-circle"},null,-1),e("span",null,"Tracking ID not found. Please check and try again.",-1)])])):x("",!0)])])]),k.value.length>0?(l(),r("div",ve,[(l(!0),r(m,null,y(k.value,(t,u)=>(l(),r("div",{key:u,class:"mb-4"},[e("div",be,[e("div",_e,[e("div",he,[e("h3",me,[s[6]||(s[6]=e("i",{class:"fa fa-barcode mr-2"},null,-1)),f(o(t.tracking_id),1)]),e("span",ye,o(t.logs?.[0]?.status_remarks||"Pending"),1)])]),e("div",we,[e("div",ke,[e("div",Ae,[e("div",Me,[s[11]||(s[11]=e("h4",{class:"text-xs font-bold text-green-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-user mr-2"}),f("Personal Information ")],-1)),e("div",De,[e("div",Te,[s[7]||(s[7]=e("span",{class:"text-gray-600 w-20"},"Name:",-1)),e("span",Ie,o(t.firstname)+" "+o(t.middlename)+" "+o(t.lastname),1)]),e("div",Ce,[s[8]||(s[8]=e("span",{class:"text-gray-600 w-20"},"College:",-1)),e("span",Ne,o(t.college),1)]),e("div",je,[s[9]||(s[9]=e("span",{class:"text-gray-600 w-20"},"Course:",-1)),e("span",Re,o(t.course),1)]),e("div",Ue,[s[10]||(s[10]=e("span",{class:"text-gray-600 w-20"},"Year:",-1)),e("span",Ye,o(t.year_graduated_last_attended),1)])])]),e("div",$e,[s[13]||(s[13]=e("h4",{class:"text-xs font-bold text-gray-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-clock-o mr-2"}),f("Status Timeline ")],-1)),e("div",Se,[(l(!0),r(m,null,y(t.logs,(a,p)=>(l(),r("div",{key:p,class:"flex items-start gap-2 text-xs"},[s[12]||(s[12]=e("i",{class:"fa fa-circle text-green-600 text-[6px] mt-1.5"},null,-1)),e("div",null,[e("span",Ee,o(a.timestamp),1),e("span",Fe,o(a.status_remarks),1)])]))),128))])]),e("div",Pe,[s[15]||(s[15]=e("h4",{class:"text-xs font-bold text-blue-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-file-text mr-2"}),f("Requested Document/s ")],-1)),e("div",ze,[(l(!0),r(m,null,y(t.detail_fees_type_document_requests,(a,p)=>(l(),r("div",{key:p,class:"flex items-center gap-2 text-xs"},[s[14]||(s[14]=e("i",{class:"fa fa-check-circle text-blue-600 text-[10px]"},null,-1)),e("span",Ve,o(a.fee_name),1)]))),128))])]),t.details?(l(),r("div",He,[s[16]||(s[16]=e("h4",{class:"text-xs font-bold text-yellow-800 mb-1 flex items-center uppercase"},[e("i",{class:"fa fa-info-circle mr-2"}),f("Additional Details ")],-1)),e("p",qe,o(t.details),1)])):x("",!0)]),e("div",Be,[B.value[t.tracking_id]?(l(),r("div",Ke,[...s[17]||(s[17]=[e("i",{class:"fa fa-spinner fa-spin text-blue-600"},null,-1),e("span",{class:"text-blue-800"},"Uploading file...",-1)])])):A.value[t.tracking_id]?(l(),r("div",{key:1,class:v(["px-3 py-2 text-xs flex items-center gap-2",A.value[t.tracking_id].ok?"bg-green-50 border-2 border-green-300":"bg-red-50 border-2 border-red-300"])},[e("i",{class:v(A.value[t.tracking_id].ok?"fa fa-check-circle text-green-600":"fa fa-exclamation-circle text-red-600")},null,2),e("span",{class:v(A.value[t.tracking_id].ok?"text-green-800":"text-red-800")},o(A.value[t.tracking_id].msg),3)],2)):x("",!0),e("div",Le,[s[23]||(s[23]=e("div",{class:"bg-green-700 px-3 py-2 border-b-2 border-green-800"},[e("h4",{class:"text-xs font-bold text-white flex items-center uppercase"},[e("i",{class:"fa fa-comments mr-2"}),f("Additonal Informations ")])],-1)),t.additional_documents&&t.additional_documents.length>0&&t.additional_documents[0].name!=="N/A"||t.valid_id_front&&t.valid_id_front.length>0||t.valid_id_back&&t.valid_id_back.length>0?(l(),r("div",Oe,[s[18]||(s[18]=e("div",{class:"text-[10px] font-bold text-gray-700 uppercase mb-2 flex items-center gap-1"},[e("i",{class:"fa fa-thumb-tack text-green-600"}),f(),e("i",{class:"fa fa-paperclip text-green-600"}),e("span",null,"Attached Documents:")],-1)),e("div",Ge,[t.additional_documents&&t.additional_documents.length>0&&t.additional_documents[0].name!=="N/A"?(l(!0),r(m,{key:0},y(t.additional_documents,(a,p)=>(l(),r("div",{key:"doc-"+p,class:"flex-shrink-0"},[e("div",{class:v(a.url==="N/A"?"hidden":"w-10 mx-1")},[a.url&&(a.url.includes("jpg")||a.url.includes("jpeg")||a.url.includes("png"))?(l(),r("img",{key:0,src:K(a.url),alt:"Document",class:"w-10 h-10 object-cover rounded border border-gray-300 mb-1"},null,8,Je)):(l(),r("div",Qe,[a.name&&a.name.includes(".pdf")?(l(),r("i",We)):a.name&&(a.name.includes(".doc")||a.name.includes(".docx"))?(l(),r("i",Xe)):(l(),r("i",Ze))]))],2)]))),128)):x("",!0)])])):x("",!0),e("div",et,[Array.isArray(t.additional_response_details)&&t.additional_response_details.length>0&&t.additional_response_details[0].message!=="N/A"?(l(!0),r(m,{key:0},y(t.additional_response_details,(a,p)=>(l(),r("div",{key:"msg-"+p,class:v(a.sender==="Registrar"?"flex justify-start":"flex justify-end")},[e("div",{class:v(a.sender==="Registrar"?"bg-white border-2 border-gray-300 px-3 py-2 max-w-[85%] shadow-sm rounded-lg":"bg-green-700 px-3 py-2 max-w-[85%] shadow-sm border-2 border-green-800 rounded-lg")},[e("div",{class:v(a.sender==="Registrar"?"text-[10px] font-bold text-green-700 mb-1 uppercase":"text-[10px] font-bold text-white/90 mb-1 uppercase")},o(a.sender==="Registrar"?"Registrar Office":"You")+": ",3),e("p",{class:v(a.sender==="Registrar"?"text-xs text-gray-800":"text-xs text-white")},o(a.message),3),e("p",{class:v(a.sender==="Registrar"?"text-[9px] text-gray-500 mt-1":"text-[9px] text-white/70 mt-1")},o(a.timestamp),3)],2)],2))),128)):x("",!0),!Array.isArray(t.additional_response_details)||t.additional_response_details.length===0||t.additional_response_details[0].message==="N/A"?(l(),r("div",tt,[...s[19]||(s[19]=[e("i",{class:"fa fa-comment-slash text-gray-300 text-3xl mb-2"},null,-1),e("p",{class:"text-xs text-gray-500"},"No messages yet",-1)])])):x("",!0),U(re,{"enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100","enter-active-class":"transition duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95","leave-active-class":"transition duration-150"},{default:ae(()=>[R.value?(l(),r("div",st,o(S.value),1)):x("",!0)]),_:1})]),e("div",at,[e("input",{type:"file",ref_for:!0,ref:a=>F.value[t.tracking_id]=a,class:"hidden",onChange:a=>J(a,t),accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",multiple:""},null,40,rt),e("div",lt,[V(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>_.value=a),type:"text",placeholder:"Type in your message here and press Enter to send",class:"flex-1 text-xs border-2 border-gray-300 px-3 py-2 focus:ring-0 focus:border-green-700",onKeyup:le(ne(a=>E(t),["exact","prevent"]),["enter"])},null,40,nt),[[H,_.value]]),e("button",{type:"button",onClick:a=>G(t.tracking_id),class:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 text-xs font-medium transition",title:"Attach files"},[...s[20]||(s[20]=[e("i",{class:"fa fa-paperclip"},null,-1)])],8,ot),e("button",{onClick:a=>E(t),disabled:M.value||!_.value.trim(),class:"bg-green-700 hover:bg-green-800 text-white px-4 py-2 text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed"},[M.value?(l(),r("i",ct)):(l(),r("i",dt))],8,it)]),D.value[t.tracking_id]&&D.value[t.tracking_id].length>0?(l(),r("div",ut,[s[22]||(s[22]=e("div",{class:"text-[10px] font-semibold text-gray-700 mb-1"}," Selected Files (Click send to upload): ",-1)),(l(!0),r(m,null,y(D.value[t.tracking_id],a=>(l(),r("div",{key:a.name,class:"bg-blue-50 border border-blue-200 rounded px-2 py-1 flex items-center justify-between text-[10px]"},[e("div",pt,[s[21]||(s[21]=e("i",{class:"fa fa-file-o text-blue-600"},null,-1)),e("span",gt,o(a.name),1)]),e("span",xt,o((a.size/1024/1024).toFixed(2))+" MB ",1)]))),128))])):x("",!0),g.value[t.tracking_id]?(l(),r("div",ft,[e("div",{class:v([g.value[t.tracking_id].includes("successful")?"text-green-600":g.value[t.tracking_id].includes("failed")?"text-red-600":"text-blue-600","flex items-center gap-1"])},[g.value[t.tracking_id].includes("Uploading")?(l(),r("i",vt)):g.value[t.tracking_id].includes("successful")?(l(),r("i",bt)):g.value[t.tracking_id].includes("failed")?(l(),r("i",_t)):x("",!0),f(" "+o(g.value[t.tracking_id]),1)],2)])):x("",!0)])])])])])])]))),128))])):x("",!0),U(c)])}}},Dt=oe(ht,[["__scopeId","data-v-81b15956"]]);export{Dt as default};
