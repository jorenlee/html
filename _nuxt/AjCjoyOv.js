import{_ as X}from"./DiQUzcr9.js";import{_ as Z}from"./Cl_p_ECO.js";import{x as ee,r as i,e as te,c as r,b as $,f as se,a as e,i as u,d as f,m as B,z as G,F as _,g as b,o as l,t as n,n as v,w as ae,T as re,ag as le,p as de}from"#entry";import{h as Y}from"./BLMuvzoS.js";import{_ as ne}from"./DlAUqK2U.js";const oe={class:"bg-gray-50"},ie={class:"w-11/12 mx-auto my-6"},ce={class:"bg-white shadow-md border-2 border-gray-200"},ue={class:"p-4"},pe={class:"flex flex-col lg:flex-row gap-3 items-center"},ge={class:"flex-1 w-full"},xe={class:"relative"},fe={key:0,class:"mt-4 text-sm text-red-700 bg-red-50 border-2 border-red-300 py-2 px-4 flex items-center gap-2"},ve={key:0,class:"w-11/12 mx-auto mb-8"},_e={class:"bg-white shadow-lg overflow-hidden border-2 border-gray-200"},be={class:"bg-green-700 px-4 py-3 border-b-2 border-green-800"},he={class:"flex items-center justify-between"},me={class:"text-white font-semibold text-sm lg:text-base uppercase"},ye={class:"bg-green-800 text-white text-xs px-3 py-1 font-medium"},ke={class:"p-4"},we={class:"grid lg:grid-cols-2 gap-4"},Ae={class:"space-y-3"},De={class:"bg-green-50 p-3 border-2 border-green-200"},Te={class:"space-y-1.5 text-xs"},je={class:"flex"},Me={class:"text-gray-900 font-medium"},Ie={class:"flex"},Ce={class:"text-gray-900"},Re={class:"flex"},Ne={class:"text-gray-900"},Ue={class:"flex"},$e={class:"text-gray-900"},Ye={class:"bg-gray-50 p-3 border-2 border-gray-200"},Se={class:"space-y-1.5"},Ee={class:"text-gray-600"},Fe={class:"text-gray-900 font-medium ml-1"},Pe={class:"bg-blue-50 p-3 border-2 border-blue-200"},ze={class:"space-y-1"},Ve={class:"text-gray-900"},Be={key:0,class:"bg-yellow-50 p-3 border-2 border-yellow-200"},Ge={class:"text-xs text-gray-900"},qe={class:"space-y-3"},He={key:0,class:"bg-blue-50 border-2 border-blue-300 px-3 py-2 text-xs flex items-center gap-2"},Ke={class:"bg-white border-2 border-gray-200 overflow-hidden"},Le={key:0,class:"px-3 pt-2 bg-gray-100 border-b-2 border-gray-300"},Oe={class:"flex overflow-x-auto"},Je={class:"w-10 mx-1"},Qe=["src"],We={key:1,class:"w-10 h-10 bg-green-100 rounded flex items-center justify-center mb-1"},Xe={class:"w-10 mx-1"},Ze=["src"],et={key:1,class:"w-10 h-10 bg-green-100 rounded flex items-center justify-center mb-1"},tt=["src"],st={key:1,class:"w-10 h-10 bg-blue-100 rounded flex items-center justify-center mb-1"},at={key:0,class:"fa fa-file-pdf-o text-2xl text-red-600"},rt={key:1,class:"fa fa-file-word-o text-2xl text-blue-600"},lt={key:2,class:"fa fa-file-o text-2xl text-gray-600"},dt={class:"p-3 bg-gray-50 max-h-[250px] overflow-y-auto space-y-3"},nt={key:1,class:"text-center py-6"},ot={key:0,class:"bg-green-700 text-white text-xs px-3 py-1.5 shadow-lg text-center border-2 border-green-800"},it={class:"p-2 bg-white border-t-2 border-gray-300"},ct=["onChange"],ut={class:"flex gap-2"},pt=["onKeyup"],gt=["onClick"],xt=["onClick","disabled"],ft={key:0,class:"fa fa-paper-plane"},vt={key:1,class:"fa fa-spinner fa-spin"},_t={key:0,class:"mt-2 space-y-1"},bt={class:"flex items-center gap-1 flex-1 min-w-0"},ht={class:"truncate"},mt={class:"font-semibold text-gray-600 ml-2"},yt={key:1,class:"mt-2 text-[10px]"},kt={key:0,class:"fa fa-spinner fa-spin"},wt={key:1,class:"fa fa-check-circle"},At={key:2,class:"fa fa-exclamation-circle"},Dt={__name:"index",setup(Tt){const q=ee(),k=i(q.mainDevServer),h=i([]),I=i(""),w=i([]),C=i(!1),H=i({}),A=i({});te(async()=>{try{const d=await $fetch(k.value+"/api/registrar/list");h.value=S(d||[])}catch(d){console.error("Fetch error:",d)}});const R=d=>{if(!d)return"";const t=d.match(/^(.*?\.(?:jpg|jpeg|png))/i);return t?t[1]:d},S=d=>{if(!Array.isArray(d)||d.length===0)return d;const t=new Map,x=d.length;d.forEach(g=>{if(g?.tracking_id){const a=t.get(g.tracking_id);(!a||g.id>a.id)&&t.set(g.tracking_id,g)}});const o=Array.from(t.values()),s=x-o.length;return s>0&&console.log(`ðŸ§¹ Removed ${s} duplicate registrar ${s===1?"entry":"entries"}`),o},K=()=>{const d=I.value.trim().toUpperCase();if(d){const t=h.value.filter(x=>x?.tracking_id===d);w.value=S(t),C.value=w.value.length===0}else w.value=[],C.value=!1},L=i(""),N=i(""),D=i(!1),E=i(""),U=i(!1),m=i(""),F=async d=>{if(m.value.trim()){N.value="",L.value="",D.value=!0;try{const t={sender:d.firstname||"User",message:m.value.trim(),timestamp:Y().format("MMMM DD, YYYY h:mm:ss A")},o=[...Array.isArray(d.additional_response_details)?d.additional_response_details.filter(a=>a.message!=="N/A"):[],t],s={...d,additional_response_details:o};await $fetch(`${k.value}/api/registrar/${d.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:s}),await $fetch(`${k.value}/api/registrar/status/update/`,{method:"POST",headers:{"Content-Type":"application/json"},body:{id:d.id,latest_status:d.latest_status||""}}),d.additional_response_details=o;const g=h.value.findIndex(a=>a.id===d.id);return g!==-1&&(h.value[g].additional_response_details=o),E.value="âœ… Response submitted successfully!",U.value=!0,setTimeout(()=>U.value=!1,3e3),D.value=!1,m.value="",!0}catch(t){return console.error("Error updating response:",t),N.value="âŒ Failed to update record.",setTimeout(()=>N.value="",3e3),D.value=!1,!1}}},P=i({}),T=i({}),p=i({}),O=d=>{const t=P.value[d];t&&t.click()},J=async(d,t)=>{const x=Array.from(d.target.files||[]),o=t.tracking_id;if(x.length!==0){T.value[o]=x,p.value[o]="Uploading attachments...";try{const s=[];for(const j of x){const V=new FormData;V.append("file",j);const y=await $fetch(k.value+"/api/registrar/upload/",{method:"POST",body:V}),W=Array.isArray(y)?y.map(M=>({name:M.name||M.file?.split("/").pop(),url:M.url||M.file,timestamp:Y().format("MMMM DD, YYYY h:mm:ss A")})):[{name:y.name||y.file?.split("/").pop(),url:y.url||y.file,timestamp:Y().format("MMMM DD, YYYY h:mm:ss A")}];s.push(...W)}const c=[...(t.additional_documents||[]).filter(j=>j.name!=="N/A"),...s],Q={...t,additional_documents:c};await $fetch(`${k.value}/api/registrar/${t.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:Q}),t.additional_documents=c;const z=h.value.findIndex(j=>j.id===t.id);z!==-1&&(h.value[z].additional_documents=c),p.value[o]="âœ… Upload successful!",setTimeout(()=>{p.value[o]="",T.value[o]=[]},3e3)}catch(s){console.error("Attachment upload error:",s),p.value[o]="âŒ Upload failed. Please try again.",setTimeout(()=>{p.value[o]=""},5e3)}d.target.value=""}};return(d,t)=>{const x=X,o=Z;return l(),r("div",oe,[$(x),t[26]||(t[26]=se('<div class="relative" data-v-5dcde019><div class="bg-green-700 lg:h-[200px] h-[130px]" data-v-5dcde019><div class="lg:pt-10 absolute top-1/2 transform -translate-y-1/2 w-full" data-v-5dcde019><p class="font-bold uppercase text-white lg:text-2xl text-sm w-11/12 mx-auto" data-v-5dcde019> REGISTRAR </p><p class="text-xs w-11/12 mx-auto text-white" data-v-5dcde019> Appointment Tracker </p></div></div><div class="shadow-lg text-green-700" data-v-5dcde019><div class="lg:flex justify-between border-b border-gray-200 lg:pl-5" data-v-5dcde019><div class="flex items-center capitalize text-xs lg:border-b-0 border-b lg:px-0 px-1.5 py-2" data-v-5dcde019><div data-v-5dcde019><a href="/registrar" class="mr-2 hover:underline lg:h-10" data-v-5dcde019>Home</a></div><div data-v-5dcde019><i class="fas fa-caret-right" data-v-5dcde019></i><a href="/registrar/heu/appointment" class="mx-2 hover:underline lg:h-10" data-v-5dcde019>HEU Appointment</a><i class="fas fa-caret-right" data-v-5dcde019></i><a href="/registrar/track" class="mx-2 hover:underline lg:h-10" data-v-5dcde019>Track</a></div></div><div class="flex hover:text-green-800 text-white bg-white h-full" data-v-5dcde019><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-5dcde019><a href="/registrar" class="flex items-center w-fit mx-auto" data-v-5dcde019><i class="fa fa-video-camera" aria-hidden="true" data-v-5dcde019></i><span class="ml-3 whitespace-nowrap" data-v-5dcde019>Demo Guide</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-5dcde019><a href="/registrar/track" class="flex items-center w-fit mx-auto" data-v-5dcde019><i class="fa fa-universal-access" aria-hidden="true" data-v-5dcde019></i><span class="ml-3 whitespace-nowrap" data-v-5dcde019>Track</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full" data-v-5dcde019><a href="/registrar/login" class="flex items-center w-fit mx-auto" data-v-5dcde019><i class="fa fa-user" aria-hidden="true" data-v-5dcde019></i><span class="ml-3 whitespace-nowrap" data-v-5dcde019>Admin Login</span></a></div></div></div></div></div>',1)),e("div",ie,[e("div",ce,[t[5]||(t[5]=e("h2",{class:"bg-white text-green-700 text-center uppercase py-2 px-5 font-bold text-sm lg:text-base"},[e("i",{class:"fa fa-certificate mr-2"}),f("Appointment Tracker ")],-1)),e("div",ue,[e("div",pe,[e("div",ge,[e("div",xe,[B(e("input",{class:"w-full py-2.5 pl-10 pr-3 uppercase border-2 border-green-700 text-sm focus:ring-0 focus:border-green-800 transition",placeholder:"Enter 20-digit Tracking ID","onUpdate:modelValue":t[0]||(t[0]=s=>I.value=s),maxlength:"20"},null,512),[[G,I.value]]),t[2]||(t[2]=e("i",{class:"fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-green-700"},null,-1))])]),e("button",{class:"bg-green-700 hover:bg-green-800 text-white px-6 py-2.5 text-sm font-medium transition shadow-sm hover:shadow w-full lg:w-auto",onClick:K},[...t[3]||(t[3]=[e("i",{class:"fa fa-search mr-2"},null,-1),f("Track Now ",-1)])])]),C.value?(l(),r("div",fe,[...t[4]||(t[4]=[e("i",{class:"fa fa-exclamation-circle"},null,-1),e("span",null,"Tracking ID not found. Please check and try again.",-1)])])):u("",!0)])])]),w.value.length>0?(l(),r("div",ve,[(l(!0),r(_,null,b(w.value,(s,g)=>(l(),r("div",{key:g,class:"mb-4"},[e("div",_e,[e("div",be,[e("div",he,[e("h3",me,[t[6]||(t[6]=e("i",{class:"fa fa-barcode mr-2"},null,-1)),f(n(s.tracking_id),1)]),e("span",ye,n(s.logs?.[0]?.status_remarks||"Pending"),1)])]),e("div",ke,[e("div",we,[e("div",Ae,[e("div",De,[t[11]||(t[11]=e("h4",{class:"text-xs font-bold text-green-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-user mr-2"}),f("Personal Information ")],-1)),e("div",Te,[e("div",je,[t[7]||(t[7]=e("span",{class:"text-gray-600 w-20"},"Name:",-1)),e("span",Me,n(s.firstname)+" "+n(s.middlename)+" "+n(s.lastname),1)]),e("div",Ie,[t[8]||(t[8]=e("span",{class:"text-gray-600 w-20"},"College:",-1)),e("span",Ce,n(s.college),1)]),e("div",Re,[t[9]||(t[9]=e("span",{class:"text-gray-600 w-20"},"Course:",-1)),e("span",Ne,n(s.course),1)]),e("div",Ue,[t[10]||(t[10]=e("span",{class:"text-gray-600 w-20"},"Year:",-1)),e("span",$e,n(s.year_graduated_last_attended),1)])])]),e("div",Ye,[t[13]||(t[13]=e("h4",{class:"text-xs font-bold text-gray-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-clock-o mr-2"}),f("Status Timeline ")],-1)),e("div",Se,[(l(!0),r(_,null,b(s.logs,(a,c)=>(l(),r("div",{key:c,class:"flex items-start gap-2 text-xs"},[t[12]||(t[12]=e("i",{class:"fa fa-circle text-green-600 text-[6px] mt-1.5"},null,-1)),e("div",null,[e("span",Ee,n(a.timestamp),1),e("span",Fe,n(a.status_remarks),1)])]))),128))])]),e("div",Pe,[t[15]||(t[15]=e("h4",{class:"text-xs font-bold text-blue-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-file-text mr-2"}),f("Requested Document/s ")],-1)),e("div",ze,[(l(!0),r(_,null,b(s.type_document_requests,(a,c)=>(l(),r("div",{key:c,class:"flex items-center gap-2 text-xs"},[t[14]||(t[14]=e("i",{class:"fa fa-check-circle text-blue-600 text-[10px]"},null,-1)),e("span",Ve,n(a),1)]))),128))])]),s.details?(l(),r("div",Be,[t[16]||(t[16]=e("h4",{class:"text-xs font-bold text-yellow-800 mb-1 flex items-center uppercase"},[e("i",{class:"fa fa-info-circle mr-2"}),f("Additional Details ")],-1)),e("p",Ge,n(s.details),1)])):u("",!0)]),e("div",qe,[H.value[s.tracking_id]?(l(),r("div",He,[...t[17]||(t[17]=[e("i",{class:"fa fa-spinner fa-spin text-blue-600"},null,-1),e("span",{class:"text-blue-800"},"Uploading file...",-1)])])):A.value[s.tracking_id]?(l(),r("div",{key:1,class:v(["px-3 py-2 text-xs flex items-center gap-2",A.value[s.tracking_id].ok?"bg-green-50 border-2 border-green-300":"bg-red-50 border-2 border-red-300"])},[e("i",{class:v(A.value[s.tracking_id].ok?"fa fa-check-circle text-green-600":"fa fa-exclamation-circle text-red-600")},null,2),e("span",{class:v(A.value[s.tracking_id].ok?"text-green-800":"text-red-800")},n(A.value[s.tracking_id].msg),3)],2)):u("",!0),e("div",Ke,[t[25]||(t[25]=e("div",{class:"bg-green-700 px-3 py-2 border-b-2 border-green-800"},[e("h4",{class:"text-xs font-bold text-white flex items-center uppercase"},[e("i",{class:"fa fa-comments mr-2"}),f("Additonal Informations ")])],-1)),s.additional_documents&&s.additional_documents.length>0&&s.additional_documents[0].name!=="N/A"||s.valid_id_front&&s.valid_id_front.length>0||s.valid_id_back&&s.valid_id_back.length>0?(l(),r("div",Le,[t[20]||(t[20]=e("div",{class:"text-[10px] font-bold text-gray-700 uppercase mb-2 flex items-center gap-1"},[e("i",{class:"fa fa-thumb-tack text-green-600"}),f(),e("i",{class:"fa fa-paperclip text-green-600"}),e("span",null,"Attached Documents:")],-1)),e("div",Oe,[s.valid_id_front&&s.valid_id_front.length>0?(l(!0),r(_,{key:0},b(s.valid_id_front,(a,c)=>(l(),r("div",{key:"front-"+c,class:"flex-shrink-0"},[e("div",Je,[a.url&&(a.url.includes("jpg")||a.url.includes("jpeg")||a.url.includes("png"))?(l(),r("img",{key:0,src:R(a.url),alt:"Gov ID Front",class:"w-10 h-10 object-cover rounded border border-gray-300 mb-1"},null,8,Qe)):(l(),r("div",We,[...t[18]||(t[18]=[e("i",{class:"fa fa-id-card text-2xl text-green-600"},null,-1)])]))])]))),128)):u("",!0),s.valid_id_back&&s.valid_id_back.length>0?(l(!0),r(_,{key:1},b(s.valid_id_back,(a,c)=>(l(),r("div",{key:"back-"+c,class:"flex-shrink-0"},[e("div",Xe,[a.url&&(a.url.includes("jpg")||a.url.includes("jpeg")||a.url.includes("png"))?(l(),r("img",{key:0,src:R(a.url),alt:"Gov ID Back",class:"w-10 h-10 object-cover rounded border border-gray-300 mb-1"},null,8,Ze)):(l(),r("div",et,[...t[19]||(t[19]=[e("i",{class:"fa fa-id-card text-2xl text-green-600"},null,-1)])]))])]))),128)):u("",!0),s.additional_documents&&s.additional_documents.length>0&&s.additional_documents[0].name!=="N/A"?(l(!0),r(_,{key:2},b(s.additional_documents,(a,c)=>(l(),r("div",{key:"doc-"+c,class:"flex-shrink-0"},[e("div",{class:v(a.url==="N/A"?"hidden":"w-10 mx-1")},[a.url&&(a.url.includes("jpg")||a.url.includes("jpeg")||a.url.includes("png"))?(l(),r("img",{key:0,src:R(a.url),alt:"Document",class:"w-10 h-10 object-cover rounded border border-gray-300 mb-1"},null,8,tt)):(l(),r("div",st,[a.name&&a.name.includes(".pdf")?(l(),r("i",at)):a.name&&(a.name.includes(".doc")||a.name.includes(".docx"))?(l(),r("i",rt)):(l(),r("i",lt))]))],2)]))),128)):u("",!0)])])):u("",!0),e("div",dt,[Array.isArray(s.additional_response_details)&&s.additional_response_details.length>0&&s.additional_response_details[0].message!=="N/A"?(l(!0),r(_,{key:0},b(s.additional_response_details,(a,c)=>(l(),r("div",{key:"msg-"+c,class:v(a.sender==="Registrar"?"flex justify-start":"flex justify-end")},[e("div",{class:v(a.sender==="Registrar"?"bg-white border-2 border-gray-300 px-3 py-2 max-w-[85%] shadow-sm rounded-lg":"bg-green-700 px-3 py-2 max-w-[85%] shadow-sm border-2 border-green-800 rounded-lg")},[e("div",{class:v(a.sender==="Registrar"?"text-[10px] font-bold text-green-700 mb-1 uppercase":"text-[10px] font-bold text-white/90 mb-1 uppercase")},n(a.sender==="Registrar"?"Registrar Office":"You")+": ",3),e("p",{class:v(a.sender==="Registrar"?"text-xs text-gray-800":"text-xs text-white")},n(a.message),3),e("p",{class:v(a.sender==="Registrar"?"text-[9px] text-gray-500 mt-1":"text-[9px] text-white/70 mt-1")},n(a.timestamp),3)],2)],2))),128)):u("",!0),!Array.isArray(s.additional_response_details)||s.additional_response_details.length===0||s.additional_response_details[0].message==="N/A"?(l(),r("div",nt,[...t[21]||(t[21]=[e("i",{class:"fa fa-comment-slash text-gray-300 text-3xl mb-2"},null,-1),e("p",{class:"text-xs text-gray-500"},"No messages yet",-1)])])):u("",!0),$(re,{"enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100","enter-active-class":"transition duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95","leave-active-class":"transition duration-150"},{default:ae(()=>[U.value?(l(),r("div",ot,n(E.value),1)):u("",!0)]),_:1})]),e("div",it,[e("input",{type:"file",ref_for:!0,ref:a=>P.value[s.tracking_id]=a,class:"hidden",onChange:a=>J(a,s),accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",multiple:""},null,40,ct),e("div",ut,[B(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),type:"text",placeholder:"Type in your message here and press Enter to send",class:"flex-1 text-xs border-2 border-gray-300 px-3 py-2 focus:ring-0 focus:border-green-700",onKeyup:le(de(a=>F(s),["exact","prevent"]),["enter"])},null,40,pt),[[G,m.value]]),e("button",{type:"button",onClick:a=>O(s.tracking_id),class:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 text-xs font-medium transition",title:"Attach files"},[...t[22]||(t[22]=[e("i",{class:"fa fa-paperclip"},null,-1)])],8,gt),e("button",{onClick:a=>F(s),disabled:D.value||!m.value.trim(),class:"bg-green-700 hover:bg-green-800 text-white px-4 py-2 text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed"},[D.value?(l(),r("i",vt)):(l(),r("i",ft))],8,xt)]),T.value[s.tracking_id]&&T.value[s.tracking_id].length>0?(l(),r("div",_t,[t[24]||(t[24]=e("div",{class:"text-[10px] font-semibold text-gray-700 mb-1"}," Selected Files (Click send to upload): ",-1)),(l(!0),r(_,null,b(T.value[s.tracking_id],a=>(l(),r("div",{key:a.name,class:"bg-blue-50 border border-blue-200 rounded px-2 py-1 flex items-center justify-between text-[10px]"},[e("div",bt,[t[23]||(t[23]=e("i",{class:"fa fa-file-o text-blue-600"},null,-1)),e("span",ht,n(a.name),1)]),e("span",mt,n((a.size/1024/1024).toFixed(2))+" MB ",1)]))),128))])):u("",!0),p.value[s.tracking_id]?(l(),r("div",yt,[e("div",{class:v([p.value[s.tracking_id].includes("successful")?"text-green-600":p.value[s.tracking_id].includes("failed")?"text-red-600":"text-blue-600","flex items-center gap-1"])},[p.value[s.tracking_id].includes("Uploading")?(l(),r("i",kt)):p.value[s.tracking_id].includes("successful")?(l(),r("i",wt)):p.value[s.tracking_id].includes("failed")?(l(),r("i",At)):u("",!0),f(" "+n(p.value[s.tracking_id]),1)],2)])):u("",!0)])])])])])])]))),128))])):u("",!0),$(o)])}}},Nt=ne(Dt,[["__scopeId","data-v-5dcde019"]]);export{Nt as default};
