import{_ as G}from"./G7Ty7GFx.js";import{_ as z}from"./Cl_p_ECO.js";import{B as L,r as g,e as q,c as d,b as P,f as H,a as e,i as m,d as v,m as U,D as F,F as D,g as N,o as c,t as p,n as R,w as K,T as Y,ag as Q,p as W}from"#entry";import"./BLMuvzoS.js";import{_ as X}from"./DlAUqK2U.js";const Z={class:"bg-gray-50"},ee={class:"w-11/12 mx-auto my-6"},te={class:"bg-white shadow-md border-2 border-gray-200"},ae={class:"p-4"},se={class:"flex flex-col lg:flex-row gap-3 items-center"},re={class:"flex-1 w-full"},le={class:"relative"},ie={key:0,class:"mt-4 text-sm text-red-700 bg-red-50 border-2 border-red-300 py-2 px-4 flex items-center gap-2"},oe={key:0,class:"w-11/12 mx-auto mb-8"},ne={class:"bg-white shadow-lg overflow-hidden border-2 border-gray-200"},de={class:"bg-green-700 px-4 py-3 border-b-2 border-green-800"},ce={class:"flex items-center justify-between"},pe={class:"text-white font-semibold text-sm lg:text-base uppercase"},ue={class:"bg-green-800 text-white text-xs px-3 py-1 font-medium"},ge={class:"p-4"},fe={class:"grid lg:grid-cols-2 gap-4"},xe={class:"space-y-3"},ve={class:"bg-green-50 p-3 border-2 border-green-200"},me={class:"space-y-1.5 text-xs"},_e={class:"flex"},ye={class:"text-gray-900 font-medium"},be={class:"flex"},he={class:"text-gray-900"},we={class:"flex"},ke={class:"text-gray-900"},Te={class:"flex"},Ce={class:"text-gray-900"},$e={class:"bg-gray-50 p-3 border-2 border-gray-200"},Se={class:"space-y-1.5"},Pe={class:"text-gray-600"},De={class:"text-gray-900 font-medium ml-1"},Ne={class:"bg-blue-50 p-3 border-2 border-blue-200"},Re={class:"space-y-1"},Ae={class:"text-gray-900"},Oe={key:0,class:"bg-yellow-50 p-3 border-2 border-yellow-200"},Ie={class:"text-xs text-gray-900"},Ue={class:"space-y-3"},Fe={key:0,class:"bg-blue-50 border-2 border-blue-300 px-3 py-2 text-xs flex items-center gap-2"},Je={key:2,class:"space-y-2"},je={class:"bg-green-50 p-3 border-2 border-green-300"},Me=["onChange"],Ee={class:"bg-blue-50 p-3 border-2 border-blue-300"},Ve=["onChange"],Be={key:3,class:"bg-white border-2 border-gray-200 overflow-hidden"},Ge={class:"p-3 bg-gray-50 max-h-[250px] overflow-y-auto space-y-2"},ze={class:"flex justify-start"},Le={class:"bg-white border-2 border-gray-300 px-3 py-2 max-w-[85%] shadow-sm"},qe={class:"text-xs text-gray-800"},He={key:0,class:"flex justify-end"},Ke={class:"bg-green-700 px-3 py-2 max-w-[85%] shadow-sm border-2 border-green-800"},Ye={class:"text-xs text-white"},Qe={key:0,class:"bg-green-700 text-white text-xs px-3 py-1.5 shadow-lg text-center border-2 border-green-800"},We={class:"p-2 bg-white border-t-2 border-gray-300 flex gap-2"},Xe=["onKeyup"],Ze=["onClick","disabled"],et={key:0,class:"fa fa-paper-plane"},tt={key:1,class:"fa fa-spinner fa-spin"},at={__name:"index",setup(st){const J=L(),f=g(J.mainDevServer),w=g([]),k=g(""),_=g([]),T=g(!1),y=g({}),x=g({});q(async()=>{try{const r=await $fetch(f.value+"/api/registrar/list");w.value=A(r||[])}catch(r){console.error("Fetch error:",r)}});const A=r=>{if(!Array.isArray(r)||r.length===0)return r;const t=new Map,u=r.length;r.forEach(i=>{if(i?.tracking_id){const o=t.get(i.tracking_id);(!o||i.id>o.id)&&t.set(i.tracking_id,i)}});const l=Array.from(t.values()),a=u-l.length;return a>0&&console.log(`ðŸ§¹ Removed ${a} duplicate registrar ${a===1?"entry":"entries"}`),l},j=()=>{const r=k.value.trim().toUpperCase();if(r){const t=w.value.filter(u=>u?.tracking_id===r);_.value=A(t),T.value=_.value.length===0}else _.value=[],T.value=!1},M=r=>{const t=(r?.logs?.[0]?.status_remarks||"").toLowerCase();return t==="assessment"||t==="preparing documents"};async function E(r,t){const u=r.target.files?.[0];if(!u||!t)return;const l=t.tracking_id;y.value[l]=!0,x.value[l]={ok:!1,msg:""};try{const a=new FormData;a.append("file",u);const i=await $fetch(f.value+"/api/registrar/upload/",{method:"POST",body:a}),o=Array.isArray(i)?i.map(n=>({name:n.name||n.file?.split("/").pop(),url:n.url||n.file})):[{name:i.name||i.file?.split("/").pop(),url:i.url||i.file}],s=await $fetch(`${f.value}/api/registrar/payment/by-tracking/?tracking_id=${encodeURIComponent(l)}`).catch(()=>null);if(s){const n=[...s.receipt_image_url||[],...o],S={payment_id:s.payment_id||"",fullname:s.fullname||"",email:s.email||"",course:s.course||"",college:s.college||"",date_graduated_last_attended:s.date_graduated_last_attended||"",total:s.total||"",detail_fees:JSON.stringify(s.detail_fees||[]),tracking_id:s.tracking_id||l,receipt_image_url:JSON.stringify(n)};await $fetch(`${f.value}/api/registrar/payment/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:S})}else{const n={payment_id:"",fullname:"",email:"",course:"",college:"",date_graduated_last_attended:"",total:"",detail_fees:JSON.stringify([]),tracking_id:l,receipt_image_url:JSON.stringify(o)};await $fetch(f.value+"/api/registrar/payment/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:n})}try{await $fetch(f.value+"/api/registrar/status/confirm-receipt/",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:t.id,latest_status:"Confirm Receipt"}})}catch(n){console.warn("Receipt uploaded, but email notification failed:",n)}x.value[l]={ok:!0,msg:"Receipt uploaded successfully."}}catch(a){console.error("Upload receipt failed",a),x.value[l]={ok:!1,msg:"Failed to upload receipt. Please try again."}}finally{y.value[l]=!1,r.target.value=""}}async function V(r,t){const u=r.target.files?.[0];if(!u||!t)return;const l=t.tracking_id;y.value[l]=!0,x.value[l]={ok:!1,msg:""};try{const a=new FormData;a.append("file",u);const i=await $fetch(f.value+"/api/registrar/upload/",{method:"POST",body:a}),o=Array.isArray(i)?i.map(n=>({name:n.name||n.file?.split("/").pop(),url:n.url||n.file})):[{name:i.name||i.file?.split("/").pop(),url:i.url||i.file}],s=await $fetch(`${f.value}/api/registrar/payment/by-tracking/?tracking_id=${encodeURIComponent(l)}`).catch(()=>null);if(s){const n=[...s.additional_docs_image_url||[],...o],S={payment_id:s.payment_id||"",fullname:s.fullname||"",email:s.email||"",course:s.course||"",college:s.college||"",date_graduated_last_attended:s.date_graduated_last_attended||"",total:s.total||"",detail_fees:JSON.stringify(s.detail_fees||[]),tracking_id:s.tracking_id||l,receipt_image_url:JSON.stringify(s.receipt_image_url||[]),additional_docs_image_url:JSON.stringify(n)};await $fetch(`${f.value}/api/registrar/payment/${s.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:S})}else{const n={payment_id:"",fullname:"",email:"",course:"",college:"",date_graduated_last_attended:"",total:"",detail_fees:JSON.stringify([]),tracking_id:l,receipt_image_url:JSON.stringify([]),additional_docs_image_url:JSON.stringify(o)};await $fetch(f.value+"/api/registrar/payment/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:n})}try{await $fetch(f.value+"/api/registrar/status/confirm-receipt/",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:t.id,latest_status:"Confirm Receipt"}})}catch(n){console.warn("File uploaded, but email notification failed:",n)}x.value[l]={ok:!0,msg:"Additional document uploaded successfully."}}catch(a){console.error("Upload additional docs failed",a),x.value[l]={ok:!1,msg:"Failed to upload additional document. Please try again."}}finally{y.value[l]=!1,r.target.value=""}}const B=g(""),C=g(""),b=g(!1),O=g(""),$=g(!1),h=g(""),I=async r=>{C.value="",B.value="",b.value=!0;try{const t={...r,additional_response_details:h.value||""};await $fetch(`${f.value}/api/registrar/${r.id}/edit/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t}),r.additional_response_details=t.additional_response_details;const u=w.value.findIndex(l=>l.id===r.id);return u!==-1&&(w.value[u].additional_response_details=t.additional_response_details),O.value="âœ… Response submitted successfully!",$.value=!0,setTimeout(()=>$.value=!1,3e3),b.value=!1,h.value="",!0}catch(t){return console.error("Error updating response:",t),C.value="âŒ Failed to update record.",setTimeout(()=>C.value="",3e3),b.value=!1,!1}};return(r,t)=>{const u=G,l=z;return c(),d("div",Z,[P(u),t[25]||(t[25]=H('<div class="relative" data-v-c98e494a><div class="bg-green-700 lg:h-[200px] h-[130px]" data-v-c98e494a><div class="lg:pt-10 absolute top-1/2 transform -translate-y-1/2 w-full" data-v-c98e494a><p class="font-bold uppercase text-white lg:text-2xl text-sm w-11/12 mx-auto" data-v-c98e494a> REGISTRAR </p><p class="text-xs w-11/12 mx-auto text-white" data-v-c98e494a> Appointment Tracker </p></div></div><div class="shadow-lg text-green-700" data-v-c98e494a><div class="lg:flex justify-between border-b border-gray-200 lg:pl-5" data-v-c98e494a><div class="flex items-center capitalize text-xs lg:border-b-0 border-b lg:px-0 px-1.5 py-2" data-v-c98e494a><div data-v-c98e494a><a href="/registrar" class="mr-2 hover:underline lg:h-10" data-v-c98e494a>Home</a></div><div data-v-c98e494a><i class="fas fa-caret-right" data-v-c98e494a></i><a href="/registrar/heu/appointment" class="mx-2 hover:underline lg:h-10" data-v-c98e494a>HEU Appointment</a><i class="fas fa-caret-right" data-v-c98e494a></i><a href="/registrar/track" class="mx-2 hover:underline lg:h-10" data-v-c98e494a>Track</a></div></div><div class="flex hover:text-green-800 text-white bg-white h-full" data-v-c98e494a><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-c98e494a><a href="/registrar" class="flex items-center w-fit mx-auto" data-v-c98e494a><i class="fa fa-video-camera" aria-hidden="true" data-v-c98e494a></i><span class="ml-3 whitespace-nowrap" data-v-c98e494a>Demo Guide</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full border-r" data-v-c98e494a><a href="/registrar/track" class="flex items-center w-fit mx-auto" data-v-c98e494a><i class="fa fa-universal-access" aria-hidden="true" data-v-c98e494a></i><span class="ml-3 whitespace-nowrap" data-v-c98e494a>Track</span></a></div><div class="hover:bg-green-800 border-x bg-white hover:text-white text-green-800 px-1 lg:px-4 lg:h-10 h-8 flex items-center capitalize text-xs lg:py-2 py-1 lg:w-fit w-full" data-v-c98e494a><a href="/registrar/login" class="flex items-center w-fit mx-auto" data-v-c98e494a><i class="fa fa-user" aria-hidden="true" data-v-c98e494a></i><span class="ml-3 whitespace-nowrap" data-v-c98e494a>Admin Login</span></a></div></div></div></div></div>',1)),e("div",ee,[e("div",te,[t[5]||(t[5]=e("h2",{class:"bg-white text-green-700 text-center uppercase py-2 px-5 font-bold text-sm lg:text-base"},[e("i",{class:"fa fa-certificate mr-2"}),v("Appointment Tracker ")],-1)),e("div",ae,[e("div",se,[e("div",re,[e("div",le,[U(e("input",{class:"w-full py-2.5 pl-10 pr-3 uppercase border-2 border-green-700 text-sm focus:ring-0 focus:border-green-800 transition",placeholder:"Enter 20-digit Tracking ID","onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),maxlength:"20"},null,512),[[F,k.value]]),t[2]||(t[2]=e("i",{class:"fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-green-700"},null,-1))])]),e("button",{class:"bg-green-700 hover:bg-green-800 text-white px-6 py-2.5 text-sm font-medium transition shadow-sm hover:shadow w-full lg:w-auto",onClick:j},[...t[3]||(t[3]=[e("i",{class:"fa fa-search mr-2"},null,-1),v("Track Now ",-1)])])]),T.value?(c(),d("div",ie,[...t[4]||(t[4]=[e("i",{class:"fa fa-exclamation-circle"},null,-1),e("span",null,"Tracking ID not found. Please check and try again.",-1)])])):m("",!0)])])]),_.value.length>0?(c(),d("div",oe,[(c(!0),d(D,null,N(_.value,(a,i)=>(c(),d("div",{key:i,class:"mb-4"},[e("div",ne,[e("div",de,[e("div",ce,[e("h3",pe,[t[6]||(t[6]=e("i",{class:"fa fa-barcode mr-2"},null,-1)),v(p(a.tracking_id),1)]),e("span",ue,p(a.logs?.[0]?.status_remarks||"Pending"),1)])]),e("div",ge,[e("div",fe,[e("div",xe,[e("div",ve,[t[11]||(t[11]=e("h4",{class:"text-xs font-bold text-green-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-user mr-2"}),v("Personal Information ")],-1)),e("div",me,[e("div",_e,[t[7]||(t[7]=e("span",{class:"text-gray-600 w-20"},"Name:",-1)),e("span",ye,p(a.firstname)+" "+p(a.middlename)+" "+p(a.lastname),1)]),e("div",be,[t[8]||(t[8]=e("span",{class:"text-gray-600 w-20"},"College:",-1)),e("span",he,p(a.college),1)]),e("div",we,[t[9]||(t[9]=e("span",{class:"text-gray-600 w-20"},"Course:",-1)),e("span",ke,p(a.course),1)]),e("div",Te,[t[10]||(t[10]=e("span",{class:"text-gray-600 w-20"},"Year:",-1)),e("span",Ce,p(a.year_graduated_last_attended),1)])])]),e("div",$e,[t[13]||(t[13]=e("h4",{class:"text-xs font-bold text-gray-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-clock-o mr-2"}),v("Status Timeline ")],-1)),e("div",Se,[(c(!0),d(D,null,N(a.logs,(o,s)=>(c(),d("div",{key:s,class:"flex items-start gap-2 text-xs"},[t[12]||(t[12]=e("i",{class:"fa fa-circle text-green-600 text-[6px] mt-1.5"},null,-1)),e("div",null,[e("span",Pe,p(o.timestamp),1),e("span",De,p(o.status_remarks),1)])]))),128))])]),e("div",Ne,[t[15]||(t[15]=e("h4",{class:"text-xs font-bold text-blue-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-file-text mr-2"}),v("Requested Documents ")],-1)),e("div",Re,[(c(!0),d(D,null,N(a.type_document_requests,(o,s)=>(c(),d("div",{key:s,class:"flex items-center gap-2 text-xs"},[t[14]||(t[14]=e("i",{class:"fa fa-check-circle text-blue-600 text-[10px]"},null,-1)),e("span",Ae,p(o),1)]))),128))])]),a.details?(c(),d("div",Oe,[t[16]||(t[16]=e("h4",{class:"text-xs font-bold text-yellow-800 mb-1 flex items-center uppercase"},[e("i",{class:"fa fa-info-circle mr-2"}),v("Additional Details ")],-1)),e("p",Ie,p(a.details),1)])):m("",!0)]),e("div",Ue,[y.value[a.tracking_id]?(c(),d("div",Fe,[...t[17]||(t[17]=[e("i",{class:"fa fa-spinner fa-spin text-blue-600"},null,-1),e("span",{class:"text-blue-800"},"Uploading file...",-1)])])):x.value[a.tracking_id]?(c(),d("div",{key:1,class:R(["px-3 py-2 text-xs flex items-center gap-2",x.value[a.tracking_id].ok?"bg-green-50 border-2 border-green-300":"bg-red-50 border-2 border-red-300"])},[e("i",{class:R(x.value[a.tracking_id].ok?"fa fa-check-circle text-green-600":"fa fa-exclamation-circle text-red-600")},null,2),e("span",{class:R(x.value[a.tracking_id].ok?"text-green-800":"text-red-800")},p(x.value[a.tracking_id].msg),3)],2)):m("",!0),M(a)?(c(),d("div",Je,[e("div",je,[t[18]||(t[18]=e("label",{class:"text-xs font-bold text-green-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-upload mr-2"}),v("Upload Receipt ")],-1)),e("input",{type:"file",onChange:o=>E(o,a),accept:"image/*",class:"w-full text-xs text-gray-700 file:mr-3 file:py-1.5 file:px-3 file:border-0 file:text-xs file:bg-green-700 file:text-white hover:file:bg-green-800 file:cursor-pointer"},null,40,Me),t[19]||(t[19]=e("p",{class:"mt-1.5 text-[10px] text-gray-600"},"JPG, PNG â€¢ Max 5MB",-1))]),e("div",Ee,[t[20]||(t[20]=e("label",{class:"text-xs font-bold text-blue-800 mb-2 flex items-center uppercase"},[e("i",{class:"fa fa-paperclip mr-2"}),v("Additional Documents ")],-1)),e("input",{type:"file",onChange:o=>V(o,a),accept:"image/*,application/pdf",class:"w-full text-xs text-gray-700 file:mr-3 file:py-1.5 file:px-3 file:border-0 file:text-xs file:bg-blue-700 file:text-white hover:file:bg-blue-800 file:cursor-pointer"},null,40,Ve),t[21]||(t[21]=e("p",{class:"mt-1.5 text-[10px] text-gray-600"},"JPG, PNG, PDF â€¢ Max 10MB",-1))])])):m("",!0),a.follow_up_remarks?(c(),d("div",Be,[t[24]||(t[24]=e("div",{class:"bg-green-700 px-3 py-2 border-b-2 border-green-800"},[e("h4",{class:"text-xs font-bold text-white flex items-center uppercase"},[e("i",{class:"fa fa-comments mr-2"}),v("Latest Conversation ")])],-1)),e("div",Ge,[e("div",ze,[e("div",Le,[t[22]||(t[22]=e("div",{class:"text-[10px] font-bold text-green-700 mb-1 uppercase"},"Registrar Office:",-1)),e("p",qe,p(a.follow_up_remarks),1)])]),a.additional_response_details?(c(),d("div",He,[e("div",Ke,[t[23]||(t[23]=e("div",{class:"text-[10px] font-bold text-white/90 mb-1 uppercase"},"You:",-1)),e("p",Ye,p(a.additional_response_details),1)])])):m("",!0),P(Y,{"enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100","enter-active-class":"transition duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95","leave-active-class":"transition duration-150"},{default:K(()=>[$.value?(c(),d("div",Qe,p(O.value),1)):m("",!0)]),_:1})]),e("div",We,[U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>h.value=o),type:"text",placeholder:"Type your reply...",class:"flex-1 text-xs border-2 border-gray-300 px-3 py-2 focus:ring-0 focus:border-green-700",onKeyup:Q(W(o=>I(a),["exact","prevent"]),["enter"])},null,40,Xe),[[F,h.value]]),e("button",{onClick:o=>I(a),disabled:b.value||!h.value.trim(),class:"bg-green-700 hover:bg-green-800 text-white px-4 py-2 text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed"},[b.value?(c(),d("i",tt)):(c(),d("i",et))],8,Ze)])])):m("",!0)])])])])]))),128))])):m("",!0),P(l)])}}},dt=X(at,[["__scopeId","data-v-c98e494a"]]);export{dt as default};
